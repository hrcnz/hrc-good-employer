
$(function(){var j="1tqmFWhHqsCQ7-OjwHaDxW66xJ_3R8hTbF3PqTCEikbg";var d="https://docs.google.com/spreadsheet/pub?hl=en_US&hl=en_US&key="+j+"&output=html";var i="http://hrcnz.github.io/hrc-good-employer";var b={};var n={};var l={};var e={};var k={white:{r:255,g:255,b:255},dark:{r:97,g:97,b:97},medium:{r:160,g:160,b:160},light:{r:210,g:210,b:210},lighter:{r:237,g:237,b:237},all:{r:115,g:28,b:31},all_light:{r:210,g:164,b:166},entity:{r:36,g:173,b:162},entity_light:{r:203,g:227,b:225},type:{r:163,g:185,b:64},type_light:{r:220,g:227,b:179},size:{r:36,g:98,b:132},size_light:{r:185,g:195,b:212}};var h="978-0-478-35664-9";b.Control=Backbone.Model.extend({color:function(r,o){r=typeof r!=="undefined"?r:false;o=typeof o!=="undefined"?o:false;var p=this.get("report");var q;if(p==="all"){q=r?k.all_light:k.all}else{if(p==="entity"){q=r?k.entity_light:k.entity}else{if(p==="type"){q=r?k.type_light:k.type}else{if(p==="size"){q=r?k.size_light:k.size}}}}return o?g(q):q},accordionCloseAll:function(){$(".accordion").removeClass("open");$(".accordion-bottom").slideUp();$(".accordion-top").attr("aria-expanded",false);$(".accordion-top").attr("aria-selected",false);$(".accordion-bottom").attr("aria-expanded",false);$(".accordion-bottom").attr("aria-hidden",true);$("a.accordion-open").attr("aria-hidden",false);$("a.accordion-false").attr("aria-hidden",true)},renderPdf:function(){$.getJSON("data/pdfimagedata.json",function(o){e.docWriter=new b.DocWriter({images:o});e.viewsIntro.renderPdf(e.docWriter);e.viewsOverview.renderPdf(e.docWriter);e.docWriter.addText("1/2","page_no");e.viewsDetails.renderPdf(e.docWriter);e.docWriter.addText("2/2","page_no");e.viewsFooter.renderPdf(e.docWriter);e.docWriter.output()})}});b.Year=Backbone.Model.extend({initialize:function(){this.set("summaryoverview",this.get("summaryoverview").replace(/[^\u0000-\u007E]/g," ").replace("  "," "));this.set("summarygeref",this.get("summarygeref").replace(/[^\u0000-\u007E]/g," ").replace("  "," "));this.set("summaryeeoref",this.get("summaryeeoref").replace(/[^\u0000-\u007E]/g," ").replace("  "," "));this.set("summarygeelements",this.get("summarygeelements").replace(/[^\u0000-\u007E]/g," ").replace("  "," "));this.set("summaryreview",this.get("summaryreview").replace(/[^\u0000-\u007E]/g," ").replace("  "," "));this.set("summarywp",this.get("summarywp").replace(/[^\u0000-\u007E]/g," ").replace("  "," "));this.set("summaryparticipation",this.get("summaryparticipation").replace(/[^\u0000-\u007E]/g," ").replace("  "," "))},isActive:function(){return(this.get("active"))==="TRUE"?true:false}});b.Years=Backbone.Collection.extend({model:b.Year,initialize:function(){this.sort_key="year"},byYear:function(p){var o=this.filter(function(q){return q.get("year")===p});return new b.Years(o)},byYears:function(p){var o=this.filter(function(q){return($.inArray(q.get("year").toString(),p)>-1)});return new b.Years(o)},comparator:function(p,o){p=p.get(this.sort_key);o=o.get(this.sort_key);return p<o?1:p>o?-1:0},getLast:function(){this.active().sort();return this.first().get("year")},getFirst:function(){this.active().sort();return this.last().get("year")},active:function(){var o=this.filter(function(p){return p.isActive()});return new b.Years(o)}});b.Type=Backbone.Model.extend({});b.Types=Backbone.Collection.extend({model:b.Type,initialize:function(){this.sort_key="title";this.sort_dir="asc"},byRecords:function(o){var p=this.filter(function(q){return(o.hasType(q.get("id")))});return new b.Types(p)},comparator:function(p,o){var q=this.sort_dir==="asc"?1:-1;p=p.get(this.sort_key).toLowerCase();o=o.get(this.sort_key).toLowerCase();return q*((p>o)?1:(p<o)?-1:0)},sortBy:function(o,p){p=typeof p!=="undefined"?p:"asc";this.sort_key=o;this.sort_dir=p;return this.sort()}});b.Size=Backbone.Model.extend({});b.Sizes=Backbone.Collection.extend({model:b.Size,bySize:function(o){var p=this.filter(function(q){return(Math.ceil(o)>=q.get("min")&&Math.ceil(o)<=q.get("max"))});return new b.Sizes(p)},byRecords:function(o){var p=this.filter(function(q){return(o.hasSize(q.get("min")))});return new b.Sizes(p)}});b.Criterion=Backbone.Model.extend({initialize:function(){this.set("id",this.get("id").replace("_",""))}});b.Criteria=Backbone.Collection.extend({model:b.Criterion,getMax:function(){return this.length},byGroup:function(p){var o=this.filter(function(q){return q.get("criteriongroupid")===p});return new b.Criteria(o)}});b.CriteriaGroup=Backbone.Model.extend({initialize:function(){this.count_criteria()},count_criteria:function(){var p=0;var o=this;e.Criteria.each(function(q){if(q.get("criteriongroupid")===o.get("id")){p++}});this.count=p}});b.CriteriaGroups=Backbone.Collection.extend({model:b.CriteriaGroup});b.Record=Backbone.Model.extend({initialize:function(){this.set("typeid",this.get("typeid").trim());this.set("summaryoverview",this.get("summaryoverview").toString().replace(/[^\u0000-\u007E]/g," ").replace("  "," "));if(this.get("summaryoverview")==="0"){this.set("summaryoverview","")}if(this.get("staffno")===""){this.set("staffno",0)}if(this.get("type")===""){this.set("type","NS")}},isActive:function(o){o=typeof o!=="undefined"?o:true;return(this.get("active"))==="TRUE"?true:!o},getScore:function(q){q=typeof q!=="undefined"?q:false;var p=0;var o=this;e.Criteria.each(function(r){p+=o.getCriterionScore(r.id)});if(q){return Math.round((p/e.Criteria.getMax())*100)}else{return p}},getCriterionScore:function(o){return($.isNumeric(this.get(o)))?this.get(o):0},getGroupScore:function(o,s){s=typeof s!=="undefined"?s:false;var r=0;var q=0;var p=this;e.Criteria.each(function(t){if(t.get("criteriongroupid")===o){r+=p.getCriterionScore(t.id);q++}});if(s){return Math.round((r/q)*100)}else{return r}},getRank:function(){return e.Records.byScore(this.get("year"),this.getScore()).length+1},getScoreChange:function(q,p){q=typeof q!=="undefined"?q:false;p=typeof p!=="undefined"?p:this.get("year")-1;var o=e.Records.byEntity(this.get("entityid")).byYear(p).models[0];if(typeof o!=="undefined"){return this.getScore(q)-o.getScore(q)}else{return false}},getRankChange:function(p){p=typeof p!=="undefined"?p:this.get("year")-1;var o=e.Records.byEntity(this.get("entityid")).byYear(p).models[0];if(typeof o!=="undefined"){return -1*(this.getRank()-o.getRank())}else{return false}},getStaffNo:function(){return this.get("staffno")},getTypeTitle:function(){return e.Types.findWhere({id:this.get("typeid")}).get("title")},getStaffTitle:function(){return(this.get("staffno")>0)?this.get("staffno"):"Not specified"},getStaffCatTitle:function(){return e.Sizes.bySize(this.get("staffno")).first().get("title")},getSummary:function(){return(this.get("summaryoverview")!=="")?this.get("summaryoverview"):e.Years.byYear(this.get("year")).models[0].get("summaryoverview")}});b.Records=Backbone.Collection.extend({model:b.Record,initialize:function(){this.sort_key="title";this.sort_dir="asc"},comparator:function(p,o){var q=this.sort_dir==="asc"?1:-1;if(this.sort_key==="score"){p=p.getScore();o=o.getScore();return q*((p>o)?1:(p<o)?-1:0)}else{if(this.sort_key==="year"){p=p.get(this.sort_key);o=o.get(this.sort_key);return q*((p>o)?1:(p<o)?-1:0)}else{p=p.get(this.sort_key).toLowerCase();o=o.get(this.sort_key).toLowerCase();return q*((p>o)?1:(p<o)?-1:0)}}},sortBy:function(o,p){p=typeof p!=="undefined"?p:"asc";this.sort_key=o;this.sort_dir=p;return this.sort()},active:function(){var o=this.filter(function(p){return p.isActive()});return new b.Records(o)},byYear:function(q,p){p=typeof p!=="undefined"?p:true;var o=this.filter(function(r){return r.isActive(p)&&r.get("year")===q});return new b.Records(o)},byEntity:function(o,q){q=typeof q!=="undefined"?q:true;var p=this.filter(function(r){return r.isActive(q)&&r.get("entityid").toString()===o.toString()});return new b.Records(p)},byType:function(q,p){p=typeof p!=="undefined"?p:true;var o=this.filter(function(r){return r.isActive(p)&&r.get("typeid")===q});return new b.Records(o)},hasType:function(o){return typeof this.findWhere({typeid:o})!=="undefined"},hasSize:function(o){return this.bySize(o).length>0},bySize:function(o,q){q=typeof q!=="undefined"?q:true;var p=this.filter(function(s){var t=0;var r=0;e.Sizes.each(function(u){if(Math.ceil(o)>=u.get("min")&&Math.ceil(o)<=u.get("max")){t=u.get("min");r=u.get("max")}});return s.isActive(q)&&Math.ceil(s.getStaffNo())>=t&&Math.ceil(s.getStaffNo())<=r});return new b.Records(p)},byScore:function(s,q,o,r){o=typeof o!=="undefined"?o:0;r=typeof r!=="undefined"?r:true;var p=this.filter(function(t){if(o!==0){return t.isActive(r)&&t.getScore()>q&&t.getScore()<=o&&t.get("year")===s}else{return t.isActive(r)&&t.getScore()>q&&t.get("year")===s}});return new b.Records(p)},getResults:function(o){var s={criterion:"all",group:"all"};var r=$.extend({},s,o);var p={};var q;if(r.criterion!=="all"){q=1}else{if(r.group!=="all"){q=e.CriteriaGroups.where({id:r.group})[0].count}else{q=e.Criteria.length}}this.sortBy("year").each(function(t){if(t.isActive()){var u=t.get("year");if(u in p){if(r.criterion!=="all"){p[u].score+=t.getCriterionScore(r.criterion)}else{if(r.group!=="all"){p[u].score+=t.getGroupScore(r.group)}else{p[u].score+=t.getScore()}}p[u].count++}else{p[u]={};p[u].year=u;if(r.criterion!=="all"){p[u].score=t.getCriterionScore(r.criterion)}else{if(r.group!=="all"){p[u].score=t.getGroupScore(r.group)}else{p[u].score=t.getScore()}}p[u].count=1}p[u].percentage=Math.round(((p[u].score/p[u].count)/q)*100)}});return p}});b.Intro=Backbone.Model.extend({initialize:function(){this.minYear=e.Years.getFirst();this.maxYear=e.Years.getLast();this.title="Crown Entities and the Good Employer";this.subtitle="Annual Report Review "+this.minYear+" to "+this.maxYear;this.summary=$("#loading .summary p").html()}});n.Intro=Backbone.View.extend({initialize:function(){this.render()},render:function(){this.$el.html(this.template(this.model));return this},template:_.template('<div class="row">\n<div class="col-left">\n<h1 id="intro-title"><%= title %></h1>\n<h2><%= subtitle %></h2>\n<div class="summary"><p><%= summary %></p></div>\n</div>\n<div class="col-right">\n<a class="home-link" href="#" title="Reset Application: Crown Entities and the Good Employer"></a>\n</div>\n</div>'),renderPdf:function(o){console.log("intro.renderpdf");o.addText(this.model.title,"intro_title");o.addText(this.model.subtitle,"intro_subtitle");o.addText(this.model.summary,"intro_summary");o.addLine("intro_line");o.addImage("intro_logo","intro_logo")}});n.Tools=Backbone.View.extend({initialize:function(){this.render();this.listenTo(this.model,"change",this.render)},render:function(){var o=e.Records.byYear(parseInt(this.model.get("year")));var p=e.Years.active();if(this.model.get("report")==="entity"){p=p.byYears(Object.keys(e.Records.byEntity(this.model.get("id")).getResults()))}else{if(this.model.get("report")==="size"){p=p.byYears(Object.keys(e.Records.bySize(this.model.get("id")).getResults()))}else{if(this.model.get("report")==="type"){p=p.byYears(Object.keys(e.Records.byType(this.model.get("id")).getResults()))}}}var q={entities:o.models,types:e.Types.byRecords(o).sort().models,sizes:e.Sizes.byRecords(o).models,years:p.models,allActive:(this.model.get("report")==="all")?"active":"",entityActiveID:(this.model.get("report")==="entity")?this.model.get("id"):"",typeActiveID:(this.model.get("report")==="type")?this.model.get("id"):"",sizeActiveMin:(this.model.get("report")==="size")?this.model.get("id"):-1,yearActive:parseInt(this.model.get("year"))};this.$el.html(this.template($.extend(q,{select_width:178})));this.$("select#entity").select2({placeholder:"Entity",allowClear:true});this.$("select#type").select2({placeholder:"Type",allowClear:true,minimumResultsForSearch:99});this.$("select#size").select2({placeholder:"Size",allowClear:true,minimumResultsForSearch:99});this.$("select#year").select2({minimumResultsForSearch:99});this.initFullscreen();return this},events:{"click #all":"selectAll","click #renderPdf":"renderPdf","change #entity":"selectEntity","change #type":"selectType","change #size":"selectSize","change #year":"selectYear"},selectAll:function(o){o.preventDefault();e.App.navigate(this.model.get("year")+"/report/all-entities",{trigger:true})},selectEntity:function(o){o.preventDefault();if(this.$("#entity").val()!==""){e.App.navigate(this.model.get("year")+"/report/entity-"+this.$("#entity").val(),{trigger:true})}else{e.App.navigate(this.model.get("year")+"/report/all-entities",{trigger:true})}},selectType:function(o){o.preventDefault();if(this.$("#type").val()!==""){e.App.navigate(this.model.get("year")+"/report/type-"+this.$("#type").val(),{trigger:true})}else{e.App.navigate(this.model.get("year")+"/report/all-entities",{trigger:true})}},selectSize:function(o){o.preventDefault();if(this.$("#size").val()!==""){e.App.navigate(this.model.get("year")+"/report/size-"+this.$("#size").val(),{trigger:true})}else{e.App.navigate(this.model.get("year")+"/report/all-entities",{trigger:true})}},selectYear:function(o){o.preventDefault();e.App.navigate(this.$("#year").val()+"/report/"+this.model.get("report")+"-"+this.model.get("id"),{trigger:true})},renderPdf:function(o){o.preventDefault();_gaq.push(["_trackEvent","PDF-Report",this.model.get("year")+"-"+this.model.get("report")+"-"+this.model.get("id"),this.model.get("year")+"-"+this.model.get("report")+"-"+this.model.get("id")]);this.model.renderPdf()},template:_.template('<div class="row">\n  <h3 id="tools-title" class="medium pull-left">Select a report for a specific entity or a group of entities</h3>\n  <div aria-hidden="true" role="presentation">\n    <a href="#" class="fullscreen hidden-fullscreen hidden-standalone pull-right" data-toggle="fullscreen">Enter fullscreen <span class="icon-fullscreen-open"></span></a>    <a href="#" class="fullscreen visible-fullscreen hidden-standalone pull-right" data-toggle="fullscreen-close">Exit fullscreen <span class="icon-fullscreen-close"></span></a>\n  </div>\n</div>\n<div class="row" id="report-select"><button role="button" id="all" class="btn <%= allActive %>" aria-pressed="<%if (allActive === "active") { %>true<% } else { %>false<% } %>" >All entities</button><select id="entity" class="select2" style="width:<%=select_width%>px;">  <option></option>  <% var group_label = "A"; %>\n  <optgroup label="<%=group_label%>">\n  <%_.forEach(entities, function (entity) {%>\n    <% if (entity.get("title").charAt(0).toUpperCase() !== group_label) { %>\n    <% group_label = entity.get("title").charAt(0).toUpperCase();  %>\n    </optgroup><optgroup label="<%=group_label%>">\n    <% }  %>\n    <option value="<%= entity.get("entityid") %>" <% if (entity.get("entityid").toString() === entityActiveID.toString()) { print ("selected") } %> >    <%= entity.get("title") %></option>  <%})%>  </optgroup>\n</select><select id="type" class="select2" style="width:<%=select_width%>px;">  <option></option>  <% _.forEach(types, function (type) {%>    <option value="<%= type.get("id") %>" <% if (type.get("id") === typeActiveID) { print ("selected") } %> >    <%= type.get("title") %></option>  <%})%></select><select id="size" class="select2" style="width:<%=select_width%>px;">  <option></option>  <% _.forEach(sizes, function (size) {%>    <option value="<%= size.get("min") %>" <% if (size.get("min") <= sizeActiveMin && size.get("max") >= sizeActiveMin) { print ("selected") } %> >    <%= size.get("title") %></option>  <%})%></select><select id="year" class="select2">  <% _.forEach(years, function (year) {%>    <option value="<%= year.get("year") %>" <% if (parseInt(year.get("year")) === yearActive) { print ("selected") } %>>    <%= year.get("year") %></option>  <%})%></select></div><!--[if gt IE 8]><!-->\n<div aria-labelledby="renderPdf" class="row"><a title="Download a pdf-version of the current report" href="#" id="renderPdf" class="pull-right">Download a pdf-version of selected report <span class="icon-download"></span></a></div><!--<![endif]-->\n'),initFullscreen:function(){if(top!==self){$("body").removeClass("standalone");var q=fullScreenApi.isFullScreen(),o;$(window).on("resize",function(){clearTimeout(o);o=setTimeout(p,300)});function p(){if(q!==fullScreenApi.isFullScreen()){if(q){$("body").removeClass("fullscreen")}else{$("body").addClass("fullscreen")}q=fullScreenApi.isFullScreen()}if(top===self){$("body").addClass("standalone")}}$("a[data-toggle='fullscreen']").attr("href",i);$("a[data-toggle='fullscreen']").click(function(s){var r=/webkit/.test(navigator.userAgent.toLowerCase());if(top!==self&&fullScreenApi.supportsFullScreen&&!r){s.preventDefault();$("html").requestFullScreen()}});$("a[data-toggle='fullscreen-close']").click(function(r){if(top!==self&&fullScreenApi.supportsFullScreen){r.preventDefault();$("html").cancelFullScreen()}})}}});b.Overview=Backbone.Model.extend({initialize:function(){this.set("updated",0);this.set("resultsAll",e.Records.getResults());this.resetFields()},update:function(){this.currentYear=parseInt(e.Control.get("year"));this.currentYearData=e.Years.byYear(this.currentYear).first();this.currentCount=this.get("resultsAll")[this.currentYear].count;this.set({year:this.currentYear,graphCollectionActive:null,graphCollection:e.Records.byYear(this.currentYear).sortBy("title","desc").sortBy("score","asc")});this.resetFields();if(e.Control.get("report")==="all"){this.set({title:"All entities",subtitle:"This report provides an overview of the compliance of all Crown entities",score:this.get("resultsAll")[this.currentYear].percentage,score_label:"Average compliance",rank_label:"Total number of Crown entities",rank:this.currentCount,summary:this.currentYearData.get("summaryoverview"),modelAverages:new b.Averages({}),modelAveragesTime:new b.AveragesTime({all:this.get("resultsAll")})});if(typeof this.get("resultsAll")[this.currentYear-1]!=="undefined"){var z=this.get("resultsAll")[this.currentYear].percentage-this.get("resultsAll")[this.currentYear-1].percentage;this.set("score_change",z);this.set("score_change_class",z>0?"up":z<0?"down":"same")}}else{if(e.Control.get("report")==="entity"){var A=e.Control.get("id");var p=e.Records.byEntity(A);var x=p.byYear(this.currentYear);if(x.length===0){}else{this.set("graphCollectionActive",x);var s=this.get("graphCollectionActive").first();var v=e.Records.byType(s.get("typeid")).getResults();var B=e.Records.bySize(s.getStaffNo()).getResults();var y="";var u="";if(s.getScoreChange(true)!==false){y=s.getScoreChange(true);u=y>0?"up":y<0?"down":"same"}var D="";var r="";if(s.getRankChange()!==false){D=s.getRankChange();r=D>0?"up":D<0?"down":"same"}this.set({modelAverages:new b.Averages({all:this.get("resultsAll")[this.currentYear].percentage,type:v[this.currentYear].percentage,size:B[this.currentYear].percentage}),modelAveragesTime:new b.AveragesTime({all:this.get("resultsAll"),type:v,size:B,entity:p.getResults(),type_label:"Same type: "+s.getTypeTitle(),size_label:"Same size: "+s.getStaffCatTitle(),entity_label:"Entity: "+s.get("title")})});this.set({title:s.get("title"),subtitle:s.get("explanation"),type_label:"Type",type:s.getTypeTitle(),type_id:s.get("typeid"),size_label:"Size",size:s.getStaffCatTitle(),size_id:s.getStaffNo(),score:s.getScore(true),score_change:y,score_change_class:u,rank_label:"Rank",rank:s.getRank(),rank_of:" of "+this.currentCount+" entities",rank_change:D,rank_change_class:r,summary:s.getSummary()})}}else{if(e.Control.get("report")==="type"||e.Control.get("report")==="size"){var w,o,q;if(e.Control.get("report")==="type"){var t=e.Control.get("id");w=e.Types.findWhere({id:t});o=e.Records.byType(t);q=o.getResults();this.set({title:"Category: "+w.get("title"),modelAverages:new b.Averages({all:this.get("resultsAll")[this.currentYear].percentage}),modelAveragesTime:new b.AveragesTime({all:this.get("resultsAll"),type:q,type_label:w.get("title")})})}else{if(e.Control.get("report")==="size"){var C=e.Control.get("id");w=e.Sizes.bySize(C).first();o=e.Records.bySize(C);q=o.getResults();this.set({title:"Category: "+w.get("title"),modelAverages:new b.Averages({all:this.get("resultsAll")[this.currentYear].percentage}),modelAveragesTime:new b.AveragesTime({all:this.get("resultsAll"),size:q,size_label:(w.get("title"))})})}}this.set({graphCollectionActive:o.byYear(this.currentYear),subtitle:"This report provides an overview of the compliance of selected category",score_label:"Average compliance",score:q[this.currentYear].percentage,rank_label:"Number of entities in category",rank:o.byYear(this.currentYear).length,rank_of:" of "+this.currentCount+" entities total",rank_change:"",summary:this.currentYearData.get("summaryoverview")});if(typeof q[this.currentYear-1]!=="undefined"){var z=q[this.currentYear].percentage-q[this.currentYear-1].percentage;this.set("score_change",z);this.set("score_change_class",z>0?"up":z<0?"down":"same")}}}}this.set("report",e.Control.get("report"));this.set("updated",e.Control.get("report")+e.Control.get("id")+e.Control.get("year"))},resetFields:function(){this.set({title:"",subtitle:"",type_label:"",type:"",size_label:"",size:"",score_label:"Overall compliance",score:"",score_change:"",score_change_class:"",rank_label:"",rank:"",rank_of:"",rank_change:"",rank_change_class:"",summary:""})}});n.Overview=Backbone.View.extend({initialize:function(){this.subviews={};this.render();this.listenTo(this.model,"change:updated",this.render)},events:{"click .accordion-toggle":"accordionToggle","click .load-report":"loadReport"},loadTitle:function(o){o.preventDefault();e.App.navigate(e.Control.get("year")+"/report/"+$(o.currentTarget).data("report"),+"-",+$(o.currentTarget).data("reportid"),{trigger:true})},accordionToggle:function(o){o.preventDefault();if(this.$(".accordion").hasClass("open")){this.accordionClose()}else{e.Control.accordionCloseAll();this.accordionOpen()}},accordionOpen:function(){var o=this;this.$(".accordion-bottom").slideDown(function(){o.$(".accordion").addClass("open");o.$(".accordion-top").attr("aria-expanded",true);o.$(".accordion-top").attr("aria-selected",true);o.$(".accordion-bottom").attr("aria-expanded",true);o.$(".accordion-bottom").attr("aria-hidden",false);o.$("button.accordion-open").attr("aria-hidden",true);o.$("button.accordion-false").attr("aria-hidden",false)})},accordionClose:function(){var o=this;this.$(".accordion-bottom").slideUp(function(){o.$(".accordion").removeClass("open");o.$(".accordion-top").attr("aria-expanded",false);o.$(".accordion-top").attr("aria-selected",false);o.$(".accordion-bottom").attr("aria-expanded",false);o.$(".accordion-bottom").attr("aria-hidden",true);o.$("button.accordion-open").attr("aria-hidden",false);o.$("button.accordion-false").attr("aria-hidden",true)})},render:function(){this.$el.html(this.template(this.model.attributes));this.subviews.graphView=new n.OverviewGraph({collection:this.model.get("graphCollection"),collectionActive:this.model.get("graphCollectionActive"),axis_label:"Compliance",average_line:this.model.get("score")});this.$("#overview-graph").append(this.subviews.graphView.render().el);this.subviews.graphView.renderGraph();this.subviews.averagesView=new n.Averages({model:this.model.get("modelAverages")});this.$(".averages-panel").append(this.subviews.averagesView.render().el);this.subviews.averagesGraphView=new n.AveragesTimeGraph({model:this.model.get("modelAveragesTime"),marker:false});this.$("#overview-time-graph").append(this.subviews.averagesGraphView.render().el);this.subviews.averagesGraphView.renderGraph();return this},template:_.template('<div id="overview-title" class="row" >\n  <div class="col-left">\n    <h2 id="overview-the-title" aria-label="Current report: Name of selected entity or entity group" ><%= title %></h2>\n    <% if (subtitle !== "") { %>\n    <h3 aria-label="Additional information" class="medium"><%= subtitle %></h3>\n    <% } %>\n</div>\n<div class="col-right">\n<div aria-label="Year for current report" class="year active"><%= year %></div>\n</div>\n</div><!-- #overview-title -->\n<div id="overview-cat" class="row">\n<% if (type !== "") {%>\n  <div>\n    <span class="label"><%= type_label %> </span>\n    <span><a class="load-report" data-report="type" data-reportid="<%= type_id %>" href="#<%= year %>/report/type-<%= type_id %>" title="Load Report: <%= type %>"><%= type %></a></span>\n  </div>\n<% } %>\n<% if (size !== "") {%>\n  <div>\n    <span class="label"><%= size_label %> </span>\n    <span><a class="load-report" data-report="size" data-reportid="<%= size_id %>" href="#<%= year %>/report/size-<%= size_id %>" title="Load Report: <%= size %>"><%= size %></a></span>\n  </div>\n<% } %>\n</div><!-- #overview-cat -->\n<div id="overview-graph"></div><!-- #overview-graph -->\n<div id="overview-bottom" role="tablist">\n  <div class="accordion open" >\n    <div class="accordion-top row" role="tab" aria-expanded="true" aria-selected="true">\n      <a href="#" aria-hidden="true" role="button" class="accordion-open accordion-toggle icon-accordion-toggle" title="Show more" aria-label="Show more"></a>\n      <a href="#" aria-hidden="false" role="button" class="accordion-close accordion-toggle icon-accordion-toggle" title="Show less" aria-label="Show less"></a>\n      <div class="col-left">\n        <div class="score-panel">\n          <div class="score-label"><%= score_label %></div>\n          <div class="score active"><%= score %>%</div>\n          <% if (score_change !== "") {%>\n            <div class="score-change active" aria-label="Change of score compared with last year"><div class="icon-trend <%= score_change_class %>"></div>\n            <% if (score_change > 0) {%>+<%}%><%= score_change %>%\n            </div>\n          <%}%>\n        </div>\n      </div>\n      <div class="col-right">\n        <div class="averages-panel"></div>\n      </div>\n    </div>\n    <div class="accordion-bottom row" role="tabpanel" aria-expanded="true" aria-hidden="false">\n      <div class="col-left">\n        <div class="rank-panel">\n          <div class="rank-label"><%= rank_label %></div>\n          <div class="rank active"><span class="the-rank"><%= rank %></span><span class="rank-of"><%= rank_of %></span></div>\n          <% if (rank_change !== "") {%>\n            <div class="rank-change active" aria-label="Change of score compared with last year"><div class="icon-trend <%= rank_change_class %>"></div>\n              <% if (rank_change > 0) {%>+<%}%><%= rank_change %>\n            </div>\n          <%}%>\n          </div>\n        <div class="summary-panel">\n          <p><%= summary %></p>\n        </div>\n      </div>\n      <div class="col-right">\n        <div id="overview-time-graph"></div><!-- #overview-time-graph -->\n      </div>\n    </div>\n  </div>\n</div><!-- #overview-bottom -->    '),renderPdf:function(r){var p=e.Control.color();console.log("overview.renderpdf");var t=0;var s=0;r.addText(this.model.get("year").toString(),"overview_year",{color:p});t+=r.addText(this.model.get("title"),"overview_title");t+=r.addText(this.model.get("subtitle"),"overview_subtitle",{offy:t});if(this.model.get("report")==="entity"){r.addText(this.model.get("type_label"),"overview_type_label",{offy:t});r.addText(this.model.get("type"),"overview_type",{offy:t});r.addText(this.model.get("size_label"),"overview_size_label",{offy:t});r.addText(this.model.get("size"),"overview_size",{offy:t})}r.addText(this.model.get("score_label"),"overview_score_label");r.addText(this.model.get("score").toString()+"%","overview_score",{color:p});var o=this.model.get("score_change");if(o!==""){if(o<0){o=o.toString()+"%";r.addImage("overview_"+this.model.get("report")+"_down","overview_score_trend")}else{if(o>0){o="+"+o.toString()+"%";r.addImage("overview_"+this.model.get("report")+"_up","overview_score_trend")}else{if(o===0){o=o.toString()+"%";r.addImage("overview_"+this.model.get("report")+"_same","overview_score_trend")}}}}r.addText(o,"overview_score_change",{color:p});r.addLine("overview_score_line");r.addText(this.model.get("rank_label"),"overview_rank_label");r.addText(this.model.get("rank").toString(),"overview_rank",{color:p});if(this.model.get("rank")<10){s=-5}r.addText(this.model.get("rank_of"),"overview_rank_of",{color:p,offx:s});var q=this.model.get("rank_change");if(q!==""){if(q<0){q=q.toString();r.addImage("overview_"+this.model.get("report")+"_down","overview_rank_trend")}else{if(q>0){q="+"+q.toString();r.addImage("overview_"+this.model.get("report")+"_up","overview_rank_trend")}else{if(q>0){q=q.toString();r.addImage("overview_"+this.model.get("report")+"_same","overview_rank_trend")}}}}r.addText(q,"overview_rank_change",{color:p});r.addLine("overview_rank_line");this.subviews.graphView.renderPdf(r);this.subviews.averagesGraphView.renderPdf(r,"averages_graph");if(this.model.get("modelAverages").get("all")>-1){this.subviews.averagesView.renderPdf(r,"overview_averages");r.addText(this.model.get("summary"),"overview_summary")}else{r.addText(this.model.get("summary"),"overview_summary",{offy:-15})}}});n.OverviewGraph=Backbone.View.extend({initialize:function(o){this.options=o||{};this.currentIndex=-99;this.ticks=[[0,"0%"],[25,"25%"],[50,"50%"],[75,"75%"],[100,"100%"]]},events:{"plotclick .overview-plot":"plotclick","plothover .overview-plot":"plothover"},attributes:{"class":"overview-graph row"},plotOptions:{yaxis:{tickColor:g(k.dark),color:g(k.dark),min:0,max:100,position:"right",tickLength:5,font:{color:g(k.dark),size:13}},xaxis:{tickColor:g(k.dark),show:false},legend:{show:false},grid:{hoverable:true,clickable:true,autoHighlight:true,backgroundColor:"#ffffff",show:true,aboveData:false,margin:0,labelMargin:10,markings:[],borderWidth:{top:0,right:1,bottom:1,left:0},borderColor:g(k.dark),color:g(k.dark),minBorderMargin:0,axisMargin:0},series:{shadowSize:0,bars:{show:true,fill:1,barWidth:1,align:"center",lineWidth:1}}},render:function(){this.$el.html(this.template({axis_label:this.options.axis_label}));return this},renderGraph:function(){var x=_.clone(this.plotOptions);x.yaxis.ticks=this.ticks;var s=[];var r=[];var v=[];var q=[];var p=[];x.colors=[];x.colors.push("#ffffff");x.colors.push(e.Control.color(true,true));x.colors.push("#ffffff");x.colors.push(e.Control.color(false,true));x.xaxis.min=-1.5;x.xaxis.max=this.collection.length+1.5;var w=this.$(".overview-plot-table table tbody");w.append('<tr><th scope="col">Entity</th><th scope="col">Compliance in %</th></tr>');for(var t=0;t<this.collection.length;t++){var u=this.collection.models[t];if(u.getScore(true)===0){v.push([t,u.getScore(true)])}s.push([t,u.getScore(true)]);if(this.options.collectionActive!==null){var o=this.options.collectionActive.findWhere({entityid:u.get("entityid")});if(typeof o!=="undefined"){if(u.getScore(true)===0){q.push([t,u.getScore(true)])}p.push([t,o.getScore(true)]);w.append("<tr><td>Entity (active): "+u.get("title")+"</td><td>"+u.getScore(true)+"%</td></tr>")}else{p.push([t,null])}}else{w.append("<tr><td>Entity (other): "+u.get("title")+"</td><td>"+u.getScore(true)+"%</td></tr>")}}r.push({data:s,bars:{fillColor:e.Control.color(true,true)},highlightColor:g(k.all)});r.push({data:v,points:{show:true},bars:{show:false},highlightColor:g(k.all)});r.push({data:p,bars:{fillColor:e.Control.color(false,true)},highlightColor:g(k.all)});r.push({data:q,points:{show:true},bars:{show:false},highlightColor:g(k.all)});if(e.Control.get("report")!=="entity"){r.push({data:[[-1,this.options.average_line],[this.collection.length,this.options.average_line]],lines:{show:true,lineWidth:1},bars:{show:false}});if(e.Control.get("report")==="all"){x.colors.push(g(k.all))}else{if(e.Control.get("report")==="type"){x.colors.push(g(k.type))}else{if(e.Control.get("report")==="size"){x.colors.push(g(k.size))}}}}this.plot=$.plot(this.$(".overview-plot"),r,x)},renderPdf:function(q){q.addPlot(this.plot.getCanvas(),"overview_graph");q.addText(this.options.axis_label,"overview_graph_axis_label");var p=q.item("overview_graph");for(var o=0;o<this.ticks.length;o++){q.addText(this.ticks[this.ticks.length-1-o][1],"overview_graph_ticks",{offy:p.h*0.92/(this.ticks.length-1)*o})}},plotclick:function(p,q,o){console.log("plotclick");p.preventDefault();if(o){e.App.navigate(e.Control.get("year")+"/report/entity-"+this.collection.models[o.dataIndex].get("entityid"),{trigger:true})}},plothover:function(r,u,q){var o,s;if(this.hoverTip){this.hoverTip.remove()}if(q){document.body.style.cursor="pointer";var t=q.dataIndex/this.collection.length;var p=this.collection.models[q.dataIndex];this.hoverTip=$(this.toolTipHTML(q.series.data[q.dataIndex],p,(t*100)));this.$(".overview-plot").parent().append(this.hoverTip);o=this.hoverTip.outerHeight();s=this.hoverTip.outerWidth();if(this.collection.models[q.dataIndex].getScore()===0){this.hoverTip.offset({left:q.pageX-s*t,top:q.pageY-o-15})}else{this.hoverTip.offset({left:q.pageX-s*t,top:q.pageY-o-5})}}else{document.body.style.cursor="default"}},toolTipHTML:function(q,p,r){var o="";o+='<div class="tooltip tooltip-overview">';o+='<div class="tooltip-inner-wrap">';if(p){o+='<div class="series"><strong>'+p.get("title")+"</strong></div>"}o+='<div class="stats">Compliance: '+q[1]+"%</div>";o+='<div class="stats">Rank: '+p.getRank()+"</div>";o+="</div>";o+="</div>";o+="</div>";o+="<style>.tooltip:after {left:"+r+"%;}</style>";return o},template:_.template('<div class="plot-wrapper">\n<div aria-hidden="true" role="presentation" class="yaxis-label"><%= axis_label %></div>\n<div aria-label="Compliance of all entities - Chart. Details in the following table" role="img" class="overview-plot"></div>\n<div class="overview-plot-table sr-only">\n<summary>Compliance of all entities - Table</summary>\n<table>\n<caption>Compliance of all entities, active entities highlighted</caption>\n<tbody>\n</tbody>\n</table>\n</div>\n</div>')});b.Details=Backbone.Model.extend({initialize:function(){this.set("updated",0);this.results={};this.results.all=e.Records.getResults();this.results.all_geref=e.Records.getResults({criterion:"geref"});this.results.all_ge=e.Records.getResults({group:"GE"});this.results.all_wp=e.Records.getResults({group:"WP"});this.results.all_eeoref=e.Records.getResults({criterion:"eeoref"});this.results.all_review=e.Records.getResults({criterion:"review"});this.results.all_participation=e.Records.getResults({criterion:"participation"});this.resetFields()},update:function(){this.currentYear=parseInt(e.Control.get("year"));this.currentYearData=e.Years.byYear(this.currentYear).first();this.currentCount=this.results.all[this.currentYear].count;this.resetFields();var r={geref:{},ge:{},eeoref:{},review:{},wp:{},participation:{}};var t,s;var u=this;if(e.Control.get("report")==="entity"){var w=e.Control.get("id");var o=e.Records.byEntity(w);var v=o.byYear(this.currentYear);if(v.length===0){}else{var p=v.first();s=e.Records.byType(p.get("typeid"));t=e.Records.bySize(p.getStaffNo());r.geref.entity=o.getResults({criterion:"geref"});r.ge.entity=o.getResults({group:"GE"});r.ge.entity_elements=[];_.each(e.Criteria.byGroup("GE").models,function(y){r.ge.entity_elements.push({id:y.get("id"),title:y.get("title"),results:v.getResults({criterion:y.get("id")})})});r.wp.entity=o.getResults({group:"WP"});r.wp.entity_elements=[];_.each(e.Criteria.byGroup("WP").models,function(y){r.wp.entity_elements.push({id:y.get("id"),title:y.get("title"),results:v.getResults({criterion:y.get("id")})})});r.eeoref.entity=o.getResults({criterion:"eeoref"});r.review.entity=o.getResults({criterion:"review"});r.participation.entity=o.getResults({criterion:"participation"})}}else{if(e.Control.get("report")==="type"){var q=e.Control.get("id");s=e.Records.byType(q)}else{if(e.Control.get("report")==="size"){var x=e.Control.get("id");t=e.Records.bySize(x)}}}r.geref.all=this.results.all_geref;r.ge.all=this.results.all_ge;r.ge.all_elements=[];_.each(e.Criteria.byGroup("GE").models,function(y){r.ge.all_elements.push({id:y.get("id"),title:y.get("title"),results:e.Records.byYear(u.currentYear).getResults({criterion:y.get("id")})})});r.wp.all=this.results.all_wp;r.wp.all_elements=[];_.each(e.Criteria.byGroup("WP").models,function(y){r.wp.all_elements.push({id:y.get("id"),title:y.get("title"),results:e.Records.byYear(u.currentYear).getResults({criterion:y.get("id")})})});r.eeoref.all=this.results.all_eeoref;r.review.all=this.results.all_review;r.participation.all=this.results.all_participation;if(typeof s!=="undefined"){r.geref.type=s.getResults({criterion:"geref"});r.ge.type=s.getResults({group:"GE"});r.ge.type_elements=[];_.each(e.Criteria.byGroup("GE").models,function(y){r.ge.type_elements.push({id:y.get("id"),title:y.get("title"),results:s.byYear(u.currentYear).getResults({criterion:y.get("id")})})});r.wp.type=s.getResults({group:"WP"});r.wp.type_elements=[];_.each(e.Criteria.byGroup("WP").models,function(y){r.wp.type_elements.push({id:y.get("id"),title:y.get("title"),results:s.byYear(u.currentYear).getResults({criterion:y.get("id")})})});r.eeoref.type=s.getResults({criterion:"eeoref"});r.review.type=s.getResults({criterion:"review"});r.participation.type=s.getResults({criterion:"participation"})}if(typeof t!=="undefined"){r.geref.size=t.getResults({criterion:"geref"});r.ge.size=t.getResults({group:"GE"});r.ge.size_elements=[];_.each(e.Criteria.byGroup("GE").models,function(y){r.ge.size_elements.push({id:y.get("id"),title:y.get("title"),results:t.byYear(u.currentYear).getResults({criterion:y.get("id")})})});r.wp.size=t.getResults({group:"WP"});r.wp.size_elements=[];_.each(e.Criteria.byGroup("WP").models,function(y){r.wp.size_elements.push({id:y.get("id"),title:y.get("title"),results:t.byYear(u.currentYear).getResults({criterion:y.get("id")})})});r.eeoref.size=t.getResults({criterion:"eeoref"});r.review.size=t.getResults({criterion:"review"});r.participation.size=t.getResults({criterion:"participation"})}this.set({year:this.currentYear,subview_models:{geref:new b.CriteriaDetails({criteria:"single",year:this.currentYear,id:"geref",report:e.Control.get("report"),results:r.geref,title:e.Criteria.findWhere({id:"geref"}).get("title").trim(),summary:this.currentYearData.get("summarygeref")}),ge:new b.CriteriaDetails({criteria:"group",year:this.currentYear,id:"ge",report:e.Control.get("report"),results:r.ge,title:e.CriteriaGroups.findWhere({id:"GE"}).get("title").trim(),summary:this.currentYearData.get("summarygeelements")}),eeoref:new b.CriteriaDetails({criteria:"single",year:this.currentYear,id:"eeoref",report:e.Control.get("report"),results:r.eeoref,title:e.Criteria.findWhere({id:"eeoref"}).get("title").trim(),summary:this.currentYearData.get("summaryeeoref")}),review:new b.CriteriaDetails({criteria:"single",year:this.currentYear,id:"review",report:e.Control.get("report"),results:r.review,title:e.Criteria.findWhere({id:"review"}).get("title").trim(),summary:this.currentYearData.get("summaryreview")}),wp:new b.CriteriaDetails({criteria:"group",year:this.currentYear,id:"wp",report:e.Control.get("report"),results:r.wp,title:e.CriteriaGroups.findWhere({id:"WP"}).get("title").trim(),summary:this.currentYearData.get("summarywp")}),participation:new b.CriteriaDetails({criteria:"single",year:this.currentYear,id:"participation",report:e.Control.get("report"),results:r.participation,title:e.Criteria.findWhere({id:"participation"}).get("title").trim(),summary:this.currentYearData.get("summaryparticipation")})}});this.set("updated",e.Control.get("id")+e.Control.get("year"))},resetFields:function(){this.set({subview_models:{}})}});n.Details=Backbone.View.extend({initialize:function(){this.subviews=[];this.render();this.listenTo(this.model,"change:updated",this.render)},render:function(){this.subviews=[];this.$el.html(this.template());var o=this;_.each(this.model.get("subview_models"),function(q){var p=new n.Criterion({model:q});o.subviews.push(p);o.$("#criteria-details-list").append(p.render().el)});_.each(this.subviews,function(p){p.renderGraphs();p.accordionClose(0)});return this},renderPdf:function(t,p){var r=[t.item("detail1"),t.item("detail2")];var o=[];_.each(this.subviews,function(u){var v=t.defaults.offsets.criteria[u.model.get("id")];var w={x:r[v.p-1].x+v.x,y:r[v.p-1].y+v.y};if(typeof o[v.p-1]==="undefined"){o[v.p-1]=[]}o[v.p-1].push({subview:u,pos:w})});for(var q=0;q<o.length;q++){var s=o[q];_.each(s,function(u){u.subview.renderPdf(t,u.pos)});if(q<o.length-1){t.addPage()}}return this},template:_.template('<div id="criteria-details-list" role="tablist"></div>')});b.CriteriaDetails=Backbone.Model.extend({initialize:function(){var p=this.get("results");var o=this.get("year");if(this.get("report")==="all"){this.set("score",p.all[o].percentage);if(this.get("criteria")==="group"){this.set("all_group_elements",p.all_elements)}this.set("modelAverages",new b.Averages({}));this.set("modelAveragesTime",new b.AveragesTime({all:p.all,legend:false,criterion:this.get("title")}))}else{if(this.get("report")==="entity"){if(this.get("criteria")==="group"){this.set("score",p.entity[o].percentage);this.set("entity_group_elements",p.entity_elements);this.set("all_group_elements",p.all_elements);this.set("type_group_elements",p.type_elements);this.set("size_group_elements",p.size_elements)}else{this.set("score",Math.round(p.entity[o].percentage/100)*100)}this.set("modelAverages",new b.Averages({all:p.all[o].percentage,type:p.type[o].percentage,size:p.size[o].percentage}));this.set("modelAveragesTime",new b.AveragesTime({all:p.all,type:p.type,size:p.size,entity:p.entity,legend:false,criterion:this.get("title")}))}else{if(this.get("report")==="type"){this.set("score",p.type[o].percentage);if(this.get("criteria")==="group"){this.set("all_group_elements",p.all_elements);this.set("type_group_elements",p.type_elements)}this.set("modelAverages",new b.Averages({all:p.all[o].percentage}));this.set("modelAveragesTime",new b.AveragesTime({all:p.all,type:p.type,legend:false,criterion:this.get("title")}))}else{if(this.get("report")==="size"){this.set("score",p.size[o].percentage);if(this.get("criteria")==="group"){this.set("all_group_elements",p.all_elements);this.set("size_group_elements",p.size_elements)}this.set("modelAverages",new b.Averages({all:p.all[o].percentage}));this.set("modelAveragesTime",new b.AveragesTime({all:p.all,size:p.size,legend:false,criterion:this.get("title")}))}}}}}});n.Criterion=Backbone.View.extend({initialize:function(){this.subviews={}},events:{"click .accordion-toggle":"accordionToggle"},accordionToggle:function(o){o.preventDefault();if(this.$(".accordion").hasClass("open")){this.accordionClose()}else{e.Control.accordionCloseAll();this.accordionOpen()}},accordionOpen:function(){var o=this;this.$(".accordion-bottom").slideDown(function(){o.$(".accordion").addClass("open");o.$(".accordion-top").attr("aria-expanded",true);o.$(".accordion-top").attr("aria-selected",true);o.$(".accordion-bottom").attr("aria-expanded",true);o.$(".accordion-bottom").attr("aria-hidden",false);o.$("button.accordion-open").attr("aria-hidden",true);o.$("button.accordion-false").attr("aria-hidden",false)})},accordionClose:function(p){p=typeof p!=="undefined"?p:400;var o=this;this.$(".accordion-bottom").slideUp(p,function(){o.$(".accordion").removeClass("open");o.$(".accordion-top").attr("aria-expanded",false);o.$(".accordion-top").attr("aria-selected",false);o.$(".accordion-bottom").attr("aria-expanded",false);o.$(".accordion-bottom").attr("aria-hidden",true);o.$("button.accordion-open").attr("aria-hidden",false);o.$("button.accordion-false").attr("aria-hidden",true)})},render:function(){this.$el.html(this.template(this.model.attributes));var q=this;var o=true;if(this.model.get("criteria")==="group"){var p=0;_.each(this.model.attributes.all_group_elements,function(r){if(q.model.get("report")==="all"){q.$(".group-elements").append(q.template_elements_all($.extend(r,{year:q.model.attributes.year})))}else{if(q.model.get("report")==="entity"){q.$(".group-elements").append(q.template_elements_entity($.extend(q.model.attributes,{index:p})))}else{if(q.model.get("report")==="type"){q.$(".group-elements").append(q.template_elements_type($.extend(q.model.attributes,{index:p})))}else{if(q.model.get("report")==="size"){q.$(".group-elements").append(q.template_elements_size($.extend(q.model.attributes,{index:p})))}}}}p++});o=false}this.subviews.averagesView=new n.Averages({model:this.model.get("modelAverages")});this.$(".averages-panel").append(this.subviews.averagesView.render().el);this.subviews.averagesGraphView=new n.AveragesTimeGraph({model:this.model.get("modelAveragesTime"),marker:o});this.$(".criteria-time-graph").append(this.subviews.averagesGraphView.render().el);return this},renderGraphs:function(){this.subviews.averagesGraphView.renderGraph()},renderPdf:function(t,o){t.addLine("half_line",$.extend(o,{color:k.dark}));t.addCriteriaTitle(this.model.get("title"),this.model.get("score"),this.model.get("report"),this.model.get("criteria"),o);if(this.model.get("criteria")==="single"){if(this.model.get("modelAverages").get("all")>-1){this.subviews.averagesView.renderPdf(t,"averages",{x:o.x,y:o.y+t.defaults.offsets.averages.single});t.addText(this.model.get("summary"),"half",{x:o.x,y:o.y+t.defaults.offsets.summary.single})}else{t.addText(this.model.get("summary"),"half",{x:o.x,y:o.y+t.defaults.offsets.summary.single-15})}}else{if(this.model.get("criteria")==="group"){var r=this;var q=0;var s=[];if(this.model.get("report")==="all"){s=this.model.get("all_group_elements")}else{if(this.model.get("report")==="entity"){s=this.model.get("entity_group_elements")}else{if(this.model.get("report")==="type"){s=this.model.get("type_group_elements")}else{if(this.model.get("report")==="size"){s=this.model.get("size_group_elements")}}}}var u=20;for(var q=0;q<s.length;q++){var p=s[q];t.addGroupCriteria(p.title,p.results[r.model.attributes.year].percentage,this.model.get("report"),{x:o.x,y:o.y+u});u+=6}t.addLine("half_line",{x:o.x,y:o.y+t.defaults.offsets.averages.group-3});if(this.model.get("modelAverages").get("all")>-1){this.subviews.averagesView.renderPdf(t,"averages",{x:o.x,y:o.y+t.defaults.offsets.averages.group});t.addText(this.model.get("summary"),"half",{x:o.x,y:o.y+t.defaults.offsets.summary.group})}else{t.addText(this.model.get("summary"),"half",{x:o.x,y:o.y+t.defaults.offsets.summary.group-15})}}}},template:_.template('  <div class="criteria row">\n    <div class="accordion">\n      <div class="accordion-top row" role="tab" aria-expanded="false" aria-selected="false">\n        <a href="#" aria-hidden="true" role="button" class="accordion-open accordion-toggle icon-accordion-toggle" title="Show more" aria-label="Show more"></a>\n        <a href="#" aria-hidden="false" role="button" class="accordion-close accordion-toggle icon-accordion-toggle" title="Show less" aria-label="Show less"></a>\n        <div class="col-left">\n          <h2 class="title-score-wrap">\n          <div class="title-score" >\n            <% if (report === "entity" && score === 100 && criteria === "single") { %>\n              <span class="icon-score-pass" aria-label="Entity compliant for criteria"></span><span class="the-score active sr-only"><%= score %>%</span>\n            <% } else if (report === "entity" && score === 0 && criteria === "single") { %>\n              <span class="icon-score-fail" aria-label="Entity not compliant for criteria"></span><span class="the-score active sr-only"><%= score %>%</span>\n            <% } else { %>\n              <% if (score === 0) { %> \n                <span class="icon-score-inverse" aria-label="Compliance for criteria"></span><span class="the-score active"><%= score %>%</span>\n              <% } else { %>\n                <span class="icon-score" aria-label="Compliance for criteria"></span><span class="the-score"><%= score %>%</span>\n              <% } %>\n            <% } %>\n          </div>\n          <div class="title"><a href="#" class="accordion-toggle" title="Show or hide details"><%= title %></a></div>\n        </h2><!-- .title-score-wrap -->\n        </div><!-- .col-left -->\n        <div class="col-right">\n          <div class="averages-panel"></div>\n        </div><!-- .col-right -->\n      </div><!-- .accordion-top -->\n      <div class="accordion-bottom row" role="tabpanel" aria-expanded="true" aria-hidden="false">\n        <% if (criteria === "group") { %><div class="group-elements"></div><% } %>\n        <div class="col-left">\n          <div class="summary-panel"><%= summary %></div>\n        </div><!-- .col-left -->\n        <div class="col-right">\n          <div class="criteria-time-graph"></div><!-- .criteria-time-graph -->\n        </div><!-- .col-right -->\n      </div><!-- .accordion-bottom -->\n    </div><!-- .accordion-->\n  </div><!-- .criteria -->\n'),template_elements_all:_.template('<div class="item row">\n<div class="col-1"><span class="score-all active"><%= results[year].percentage %>%</span></div>\n<div class="col-2"><span class="title"><%= title %></span></div>\n</div>\n'),template_elements_entity:_.template('<div class="item row">\n<div class="col-1">\n<% if (entity_group_elements[index].results[year].percentage >= 50 ) { %>\n<span class="score-entity"><span class="icon-score-pass-small"></span></span>\n<% } else if (entity_group_elements[index].results[year].percentage < 50 ) { %>\n<span class="score"><span class="icon-score-fail-small"></span></span>\n<% } %>\n</div>\n<div class="col-2"><span class="title"><%= entity_group_elements[index].title %></span></div>\n<div class="col-3"><span class="score-type"><%= type_group_elements[index].results[year].percentage %>%</span></div>\n<div class="col-4"><span class="score-size"><%= size_group_elements[index].results[year].percentage %>%</span></div>\n<div class="col-5"><span class="score-all"><%= all_group_elements[index].results[year].percentage %>%</span></div>\n</div>'),template_elements_type:_.template('<div class="item row">\n<div class="col-1"><span class="score-type active"><%= type_group_elements[index].results[year].percentage %>%</span></div>\n<div class="col-2"><span class="title"><%= type_group_elements[index].title %></span></div>\n<div class="col-3"><span class="score-all"><%= all_group_elements[index].results[year].percentage %>%</span></div>\n</div>'),template_elements_size:_.template('<div class="item row">\n<div class="col-1"><span class="score-size active"><%= size_group_elements[index].results[year].percentage %>%</span></div>\n<div class="col-2"><span class="title"><%= size_group_elements[index].title %></span></div>\n<div class="col-3"><span class="score-all"><%= all_group_elements[index].results[year].percentage %>%</span></div>\n</div>')});b.Averages=Backbone.Model.extend({defaults:{title:"Average compliance of",all:-1,type:-1,size:-1,all_label:"All entities",type_label:"Same type",size_label:"Same size",all_color:g(k.all),type_color:g(k.type),size_color:g(k.size)}});n.Averages=Backbone.View.extend({initialize:function(o){this.options=o||{}},render:function(){if(this.model.get("all")>-1||this.model.get("type")>-1||this.model.get("size")>-1){this.$el.html(this.template(this.model.attributes))}return this},renderPdf:function(s,q,o){var t={x:0,y:0};var p={top:2,right:16};t.y+=s.addText(this.model.get("title"),q,o);t.y+=1;var r=s.item(q,o);if(this.model.get("type")>-1){s.addText(this.model.get("type_label"),"default",{x:r.x+t.x,y:r.y+t.y+p.top});s.addText(this.model.get("type")+"%","default",{x:r.x+t.x+p.right,y:r.y+t.y+p.top,style:"bold",color:k.type});t.x+=s.addAverageBar(this.model.get("type"),{x:r.x+t.x,y:r.y+t.y,color:k.type})}if(this.model.get("size")>-1){s.addText(this.model.get("size_label"),"default",{x:r.x+t.x,y:r.y+t.y+p.top});s.addText(this.model.get("size")+"%","default",{x:r.x+t.x+p.right,y:r.y+t.y+p.top,style:"bold",color:k.size});t.x+=s.addAverageBar(this.model.get("size"),{x:r.x+t.x,y:r.y+t.y,color:k.size})}if(this.model.get("all")>-1){s.addText(this.model.get("all_label"),"default",{x:r.x+t.x,y:r.y+t.y+p.top});s.addText(this.model.get("all")+"%","default",{x:r.x+t.x+p.right,y:r.y+t.y+p.top,style:"bold",color:k.all});t.x+=s.addAverageBar(this.model.get("all"),{x:r.x+t.x,y:r.y+t.y,color:k.all})}t.y+=9;s.addLine("half_line",{x:r.x,y:r.y+t.y})},template:_.template('    <div class="averages">\n      <div class="averages-title"><%=title%></div>\n      <ul class="averages-list">\n      <% if (type > -1) {%>\n      <li>\n        <div class="average-type averages-full"><span class="averages-score" style="width:<%=type%>%;background:<%=type_color%>;"></span></div>\n        <div><%=type_label%> <%=type%>%</div>\n      </li><% }%>\n      <% if (size > -1) {%>\n      <li>\n        <div class="average-size averages-full"><span class="averages-score" style="width:<%=size%>%;background:<%=size_color%>;"></span></div>\n        <div><%=size_label%> <%=size%>%</div>\n      </li><% }%>\n      <% if (all > -1) {%>\n      <li>\n        <div class="average-all averages-full"><span class="averages-score" style="width:<%=all%>%;background:<%=all_color%>;"></span></div>\n        <div><%=all_label%> <%=all%>%</div>\n      </li><% }%>\n    </div>\n    ')});b.AveragesTime=Backbone.Model.extend({defaults:{title:"Compliance over time",criterion:"Overall compliance",all:{},type:{},size:{},entity:{},all_label:"All entities",type_label:"Same type",size_label:"Same size",entity_label:"Current entity",legend:true,axis_label:"Compliance"}});n.AveragesTimeGraph=Backbone.View.extend({initialize:function(o){this.options=o||{};this.ticks=[[0,"0%"],[50,"50%"],[100,"100%"]];this.axis_padding=0.05},attributes:{"class":"time-graph"},events:{"plothover .time-plot":"plothover","plotclick .time-plot":"plotclick"},plotOptions:{yaxis:{tickColor:g(k.dark),color:g(k.dark),min:0,max:100,position:"right",tickLength:5,font:{color:g(k.dark),size:13},autoscaleMargin:0},xaxis:{color:g(k.dark),tickSize:1,tickDecimals:0,tickLength:0,font:{color:g(k.dark),size:13,weight:"bold"},autoscaleMargin:0},legend:{show:false},grid:{hoverable:true,clickable:true,autoHighlight:true,backgroundColor:"#ffffff",show:true,aboveData:false,margin:0,labelMargin:10,markings:[],borderWidth:{top:0,right:1,bottom:1,left:0},borderColor:g(k.dark),color:g(k.dark),minBorderMargin:0,axisMargin:0},series:{shadowSize:0}},render:function(){this.$el.html(this.template($.extend(this.model.attributes,{cid:this.cid})));return this},lineOptions:function(o,q){var r=1.7;var p=2.5;if(o==="all"){if(e.Control.get("report")==="all"){return $.extend(q,{lines:{show:true,lineWidth:p},points:{show:true}})}else{return $.extend(q,{dashes:{show:true,lineWidth:r,dashLength:2}})}}else{if(o==="type"){if(e.Control.get("report")==="type"){return $.extend(q,{lines:{show:true,lineWidth:p},points:{show:true}})}else{return $.extend(q,{dashes:{show:true,lineWidth:r,dashLength:5}})}}else{if(o==="size"){if(e.Control.get("report")==="size"){return $.extend(q,{lines:{show:true,lineWidth:p},points:{show:true}})}else{return $.extend(q,{dashes:{show:true,lineWidth:r,dashLength:8}})}}else{if(o==="entity"){return $.extend(q,{lines:{show:true,lineWidth:p},points:{show:true}})}}}}},renderGraph:function(){var p=_.clone(this.plotOptions);p.yaxis.ticks=this.ticks;var s=[];var t=[];p.colors=[];var r=this.$(".time-plot-table table tbody");r.append('<tr><td></td><th scope="col">Year></th><th scope="col">Compliance in %</th></tr>');var o=Object.keys(this.model.get("all"));p.xaxis.max=Math.max.apply(Math,o)+((o.length-1)*this.axis_padding);p.xaxis.min=Math.min.apply(Math,o)-((o.length-1)*this.axis_padding);var q=this;_.each(this.model.get("all"),function(u){s.push([u.year,u.percentage]);r.append("<tr><td>"+q.model.get("all_label")+"</td><td>"+u.year+"</td><td>"+u.percentage+"%</td></tr>")});t.push(this.lineOptions("all",{data:s}));p.colors.push(g(k.all));s=[];if(!$.isEmptyObject(this.model.get("type"))){_.each(this.model.get("type"),function(u){s.push([u.year,u.percentage]);r.append("<tr><td>"+q.model.get("type_label")+"</td><td>"+u.year+"</td><td>"+u.percentage+"%</td></tr>")});t.push(this.lineOptions("type",{data:s}));p.colors.push(g(k.type))}s=[];if(!$.isEmptyObject(this.model.get("size"))){_.each(this.model.get("size"),function(u){s.push([u.year,u.percentage]);r.append("<tr><td>"+q.model.get("size_label")+"</td><td>"+u.year+"</td><td>"+u.percentage+"%</td></tr>")});t.push(this.lineOptions("size",{data:s}));p.colors.push(g(k.size))}s=[];if(!$.isEmptyObject(this.model.get("entity"))){_.each(this.model.get("entity"),function(u){s.push([u.year,u.percentage]);r.append("<tr><td>"+q.model.get("entity_label")+"</td><td>"+u.year+"</td><td>"+u.percentage+"%</td></tr>")});t.push(this.lineOptions("entity",{data:s}));p.colors.push(g(k.entity))}this.plot=$.plot(this.$(".time-plot"),t,p);if(this.model.get("legend")){$(".plot-wrapper-"+this.cid+" .legend").html(this.template_legend($.extend(this.model.attributes,{report:e.Control.get("report")})))}},plotclick:function(p,q,o){p.preventDefault();if(o){e.App.navigate(o.datapoint[0]+"/report/"+e.Control.get("report")+"-"+e.Control.get("id"),{trigger:true})}},plothover:function(q,s,p){var o,r;if(this.hoverTip){this.hoverTip.remove()}if(p){document.body.style.cursor="pointer";this.hoverTip=$(this.toolTipHTML(p.datapoint));this.$(".time-plot").parent().append(this.hoverTip);o=this.hoverTip.outerHeight();r=this.hoverTip.outerWidth();this.hoverTip.offset({left:p.pageX-r/2,top:p.pageY-o-15})}else{document.body.style.cursor="default"}},toolTipHTML:function(p){var o="";o+='<div class="tooltip tooltip-time">';o+='<div class="tooltip-inner-wrap">';o+='<div class="stats">Year: '+p[0]+"</div>";o+='<div class="stats">Compliance: '+p[1]+"%</div>";o+="</div>";o+="</div>";return o},renderPdf:function(o,w,v){o.addPlot(this.plot.getCanvas(),w,v);o.addText(this.model.get("axis_label"),w+"_axis_label");o.addText(this.model.get("title"),w+"_title");var t=o.item(w);for(var r=0;r<this.ticks.length;r++){o.addText(this.ticks[this.ticks.length-1-r][1],w+"_ticks",{offy:t.h*0.79/(this.ticks.length-1)*r})}var x=Object.keys(this.model.get("all"));for(var r=0;r<x.length;r++){var u=(t.w*0.85*(1-2*this.axis_padding)/(x.length-1)*r)+t.w*0.85*this.axis_padding;o.addText(x[r],w+"_xticks",{offx:u})}var t=o.item(w+"_legend");var p=this.model.attributes;var q=e.Control.get("report");var s=0;var u=8;if(!$.isEmptyObject(p.entity)){o.addLine(w+"_legend_line",{color:k.entity,offy:s});o.addText(p.entity_label,w+"_legend",{offx:u});s+=4}if(!$.isEmptyObject(p.type)){if(q==="type"){o.addLine(w+"_legend_line",{color:k.type,offy:s})}else{o.addLine(w+"_legend_line",{color:k.type,offy:s,dash:0.66})}o.addText(p.type_label,w+"_legend",{offx:u,offy:s});s+=4}if(!$.isEmptyObject(p.size)){if(q==="size"){o.addLine(w+"_legend_line",{color:k.size,offy:s})}else{o.addLine(w+"_legend_line",{color:k.size,offy:s,dash:1})}o.addText(p.size_label,w+"_legend",{offx:u,offy:s});s+=4}if(q==="all"){o.addLine(w+"_legend_line",{color:k.all,offy:s})}else{o.addLine(w+"_legend_line",{color:k.all,offy:s,dash:0.33})}o.addText(p.all_label,w+"_legend",{offx:u,offy:s})},template:_.template('<div class="plot-wrapper plot-wrapper-<%= cid %>">\n<div class="averages-title"><%= title %></div>\n<div aria-hidden="true" role="presentation" class="yaxis-label"><%= axis_label %></div>\n<div class="time-plot" aria-label="<%= title %> for <%= criterion %> - Chart. Details in the following table" role="img" ></div>\n<div aria-hidden="true" role="presentation" class="legend"></div>\n<div class="time-plot-table sr-only">\n<summary><%= title %> for <%= criterion %> - Table</summary>\n<table>\n<caption><%= title %> for <%= criterion %> </caption>\n<tbody>\n</tbody>\n</table>\n</div>\n</div>'),template_legend:_.template('    <ul class="legend-list"><% if (!$.isEmptyObject(entity)){%><li class="legend-entity <% if (report === "entity"){%>legend-main<% } %>">\n<span class="line"></span>\n<span class="legend-label"><%=entity_label%></span>\n</li><% }%><% if (!$.isEmptyObject(type)){%><li class="legend-type <% if (report === "type"){%>legend-main<% } %>">\n<span class="line"></span>\n<span class="legend-label"><%=type_label%></span>\n</li><% }%><% if (!$.isEmptyObject(size)){%><li class="legend-size <% if (report === "size"){%>legend-main<% } %>">\n<span class="line"></span>\n<span class="legend-label"><%=size_label%></span>\n</li><% }%><li class="legend-all <% if (report === "all"){%>legend-main<% } %>">\n<span class="line"></span>\n<span class="legend-label"><%=all_label%></span>\n</li>    </ul>    ')});b.Footer=Backbone.Model.extend({initialize:function(){this.monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],this.set({hrc_url_title:"To explore all good employer reports visit:",hrc_url_anchor:"www.hrc.co.nz/eeo",published:"Last updated: "+e.Control.get("updated").getDate()+". "+this.monthNames[e.Control.get("updated").getMonth()]+" "+e.Control.get("updated").getFullYear(),isbn:"ISBN: "+h,copyright:"&#0169; "+e.Control.get("updated").getFullYear()+" New Zealand Human Rights Commission",hrc_url:"http://www.hrc.co.nz/eeo",builtby_url:"http://dumpark.com",builtby:"a data visualisation by dumpark"})}});n.Footer=Backbone.View.extend({initialize:function(){this.render()},render:function(){this.$el.html(this.template(this.model.attributes))},renderPdf:function(o){o.addImage("footer","footer_image");o.addText(this.model.get("hrc_url_title"),"footer_url_title");o.addText(this.model.get("hrc_url_anchor"),"footer_url");o.addText(this.model.get("published"),"footer_published");o.addText(this.model.get("isbn"),"footer_isbn");o.addLine("footer_line1");o.addLine("footer_line2")},template:_.template('<div class="footer-scene">\n  <div class="col-left">\n    <div class="footer-wrap-left">\n      <div class="footer-hrcurl-title"><%= hrc_url_title %></div>\n      <div class="footer-hrcurl"><a href="<%= hrc_url %>" target="_blank" title="<%= hrc_url_title %> <%= hrc_url_anchor %>"><%= hrc_url_anchor %></a></div>\n    </div>\n  </div>\n  <div class="col-right">\n    <div class="footer-wrap-right">\n      <div class="footer-published"><%= published %></div>\n      <div class="footer-copyright"><%= copyright %></div>\n    </div>\n  </div>\n</div>\n<div class="footer-builtby pull-right"><a href="<%= builtby_url %>" target="_blank" title="<%= builtby %>"><%= builtby %></a></div>\n    ')});b.DocWriter=Backbone.Model.extend({initialize:function(){this.doc=new jsPDF({lineHeight:this.defaults.lineHeight});this.doc.setFontSize(this.defaults.elements.def.size)},defaults:{lineHeight:1.4,offsets:{averages:{single:23,group:70},detail_title:{x:15,y:11},summary:{single:42,group:89},criteria:{geref:{p:1,y:0,x:0},eeoref:{p:1,y:0,x:95},ge:{p:2,y:0,x:0},wp:{p:2,y:0,x:95},review:{p:2,y:130,x:0},participation:{p:2,y:130,x:95}}},elements:{def:{y:15,x:15,w:180,h:0,size:8,style:"normal",margin:{top:0,bottom:2,right:0,left:0},color:k.dark,offy:0,offx:0},half:{y:15,x:15,w:85,h:0,size:8,style:"normal",margin:{top:0,bottom:2,right:0,left:0},color:k.dark},intro_title:{y:15,size:17,style:"bold"},intro_subtitle:{y:24,size:10,style:"bold"},intro_summary:{y:32,w:138},intro_logo:{y:13,x:163,w:32,h:35},intro_line:{y:60,h:0.75,color:k.dark},overview_title:{y:71,w:130,size:16,yalign:"center"},overview_subtitle:{y:70,w:130,color:k.medium},overview_year:{y:63,x:169,size:27,style:"bold"},overview_type_label:{y:71,x:15,style:"bold"},overview_type:{y:71,x:23},overview_size_label:{y:75,x:15,style:"bold"},overview_size:{y:75,x:23},overview_score_label:{y:96,size:10,style:"bold"},overview_score:{y:99,size:40,style:"bold"},overview_score_trend:{y:104,x:53,w:7,h:7},overview_score_change:{y:111,x:53},overview_score_line:{y:117,w:44,h:0.75,color:k.light},overview_rank_label:{y:124,style:"bold",w:44,yalign:"center"},overview_rank:{y:126,size:23,style:"bold"},overview_rank_of:{y:131,x:25},overview_rank_trend:{y:124,x:53,w:7,h:7},overview_rank_change:{y:131,x:54},overview_rank_line:{y:138,w:44,h:0.75,color:k.light},overview_graph:{y:100,x:63,w:132,h:39.3},overview_graph_axis_label:{y:96,x:180,size:7},overview_graph_ticks:{y:103,x:188,yalign:"center"},averages_graph:{y:149,x:107,w:89,h:34},averages_graph_title:{y:144,x:110,style:"bold"},averages_graph_axis_label:{y:145,x:180,size:7},averages_graph_ticks:{y:152,x:188,yalign:"center"},averages_graph_xticks:{y:179,x:107,style:"bold"},averages_graph_legend:{y:186,x:110,size:7},averages_graph_legend_line:{y:187.6,x:110,w:5,h:1},overview_averages:{y:142.5,w:85,style:"bold"},averages:{w:85,style:"bold"},overview_summary:{y:162,w:85},average_line:{w:22,h:4,margin:{right:6},color:k.light},half_line:{w:85,h:0.75,color:k.light},detail1:{y:208},detail2:{y:15},detail_title:{style:"bold",w:65,size:11},detail_image:{w:12,h:12},detail_image_small:{w:3,h:3},detail_score:{style:"bold",size:11,color:k.white},footer_image:{y:222,w:180,color:k.white},footer_url_title:{y:270,x:20,w:75,size:7,color:k.white},footer_url:{y:273,x:20,w:75,size:10,color:k.white},footer_published:{y:255,x:103,w:56,size:7,color:k.white},footer_isbn:{y:259,x:103,w:56,size:7,color:k.white},footer_c:{y:274,x:103,w:56,size:7,style:"bold",color:k.white},footer_line1:{y:255,x:100,w:1,h:22,color:k.white},footer_line2:{y:255,x:162,w:1,h:22,color:k.white},page_no:{y:279.3,x:199,size:7}}},item:function(p,o){o=typeof o!=="undefined"?o:{};var q=$.extend({},this.defaults.elements[p]);var r=$.extend({},this.defaults.elements.def);q=$.extend(q,o);return $.extend(r,q)},convert2pt:function(o){return o*this.doc.internal.scaleFactor},convert2mm:function(o){return o/this.doc.internal.scaleFactor},output:function(){var o="HRC-Good-Employer_";if(e.Control.get("report")==="all"){o+="All-Entities"}else{if(e.Control.get("report")==="type"){o+="Type-"+e.Control.get("id")}else{if(e.Control.get("report")==="size"){o+="Size-"+e.Control.get("id")}else{if(e.Control.get("report")==="entity"){o+=e.Records.byYear(parseInt(e.Control.get("year"))).byEntity(e.Control.get("id")).first().get("title").replace(/\s/g,"-")}}}}this.doc.save(o+"_"+e.Control.get("year")+".pdf")},addText:function(r,q,u){if(r===""){return 0}q=typeof q!=="undefined"?q:"def";var t=this.item(q,u);var p=(t.yalign!=="undefined")?t.yalign:"top";this.doc.setFontSize(t.size);this.doc.setFontStyle(t.style);this.doc.setTextColor(t.color.r,t.color.g,t.color.b);r=r.toString().replace(/[\u0101]/g,"a");var o=this.doc.splitTextToSize(r,this.convert2pt(t.w/1.3));var v=o.length*this.convert2mm(t.size)*this.defaults.lineHeight+t.margin.bottom;if(p==="center"){v=v/2;t.y-=v}this.doc.text(t.x+t.offx,t.y+t.offy+this.convert2mm(t.size),o);return v},addLine:function(o,t){var s=this.item(o,t);var u="h";if(s.h>s.w){var r=s.h;s.h=s.w;s.w=r;u="v"}this.doc.setLineWidth(this.convert2mm(s.h));this.doc.setDrawColor(s.color.r,s.color.g,s.color.b);if(typeof s.dash!=="undefined"){var p=0;for(var q=0;q<Math.floor(s.w/(s.dash));q++){if(q%2===0){this.doc.line(s.x+p,s.y+s.offy,s.x+s.dash+p,s.y+s.offy)}p+=s.dash}}else{if(u==="h"){this.doc.line(s.x,s.y+s.offy,s.x+s.w,s.y+s.offy)}else{this.doc.line(s.x,s.y+s.offy,s.x,s.y+s.offy+s.w)}}},addImage:function(p,q,o,s){o=typeof o!=="undefined"?o:{};s=typeof s!=="undefined"?s:{};var r=this.item(q,s);var t=this.get("images")[p];t=$.extend(t,o);this.doc.addImage(t.data,t.format,r.x,r.y,r.w,r.h)},addPlot:function(q,v,r){var x=this.item(v,r);var o=2;var u=q.width*o;var s=q.height*o;var t=document.createElement("canvas");t.width=u;t.height=s;var w=t.getContext("2d");w.fillStyle="#FFFFFF";w.fillRect(0,0,u,s);w.drawImage(q,0,0,u,s);var p=t.toDataURL("image/jpeg");this.doc.addImage(p,"JPEG",x.x,x.y,x.w,x.h)},addAverageBar:function(q,p){this.addLine("average_line",{x:p.x,y:p.y});var o=this.item("average_line");this.addLine("average_line",{x:p.x,y:p.y,w:o.w*q/100,color:p.color});return o.w+o.margin.right},addCircle:function(o){this.doc.setFillColor(o.color.r,o.color.g,o.color.b);this.doc.circle(o.x,o.y,o.r,"F")},addTick:function(o){this.doc.setLineWidth(1.8);this.doc.setDrawColor(o.color.r,o.color.g,o.color.b);this.doc.line(o.x+3,o.y+5.69,o.x+5.62,o.y+8.31);this.doc.line(o.x+4.38,o.y+8.31,o.x+9,o.y+3.69)},addCross:function(o){this.doc.setLineWidth(1.8);this.doc.setDrawColor(o.color.r,o.color.g,o.color.b);this.doc.line(o.x+3.69,o.y+3.69,o.x+8.31,o.y+8.31);this.doc.line(o.x+3.69,o.y+8.31,o.x+8.31,o.y+3.69)},addCriteriaTitle:function(s,r,q,u,p){var o="details_"+q+"_";var t=2.2;if(r<10){t=3.2}else{if(r>99){t=1.2}}if(q==="entity"&&r===100&&u==="single"){this.addCircle({x:p.x+6,y:p.y+9.8,r:6,color:k[q]});this.addTick({x:p.x,y:p.y+4,color:k.white})}else{if(q==="entity"&&r===0&&u==="single"){this.addCircle({x:p.x+6,y:p.y+9.8,r:6,color:k.lighter});this.addCross({x:p.x,y:p.y+4,color:k.entity})}else{if(r===0){this.addCircle({x:p.x+6,y:p.y+9.8,r:6,color:k.lighter});this.addText(r+"%","detail_score",{color:k[q],x:p.x+t,y:p.y+this.defaults.offsets.detail_title.y,yalign:"center"})}else{this.addCircle({x:p.x+6,y:p.y+9.8,r:6,color:k[q]});this.addText(r+"%","detail_score",{x:p.x+t,y:p.y+this.defaults.offsets.detail_title.y,yalign:"center"})}}}this.addText(s,"detail_title",{x:p.x+this.defaults.offsets.detail_title.x,y:p.y+this.defaults.offsets.detail_title.y,yalign:"center"});this.addLine("half_line",{x:p.x,y:p.y+20})},addGroupCriteria:function(s,r,q,p){if(q==="entity"){var o="details_entity_";if(r>=50){o+="pass_small";this.addImage(o,"detail_image_small",{},{x:p.x+4.5,y:p.y+3})}else{if(r<50){o+="fail_small";this.addImage(o,"detail_image_small",{},{x:p.x+4.5,y:p.y+3})}}}else{var t=3;if(r<10){t=4}else{if(r>99){t=1.4}}this.addText(r+"%","def",{x:p.x+t,y:p.y+3,style:"bold"})}this.addText(s,"def",{x:p.x+10,y:p.y+3})},addPage:function(){this.doc.addPage()}});function m(o){$(".loading."+o).hide();$(".waiting."+o).removeClass("waiting").css("visibility","visible");$("#report").attr("aria-busy",false)}function a(p){var o=p.toString(16);return o.length===1?"0"+o:o}function g(o){return"#"+a(o.r)+a(o.g)+a(o.b)}if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}if(!Object.keys){Object.keys=(function(){var q=Object.prototype.hasOwnProperty,r=!({toString:null}).propertyIsEnumerable("toString"),p=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],o=p.length;return function(u){if(typeof u!=="object"&&(typeof u!=="function"||u===null)){throw new TypeError("Object.keys called on non-object")}var s=[],v,t;for(v in u){if(q.call(u,v)){s.push(v)}}if(r){for(t=0;t<o;t++){if(q.call(u,p[t])){s.push(p[t])}}}return s}}())}l.App=Backbone.Router.extend({routes:{"":"redirect","report/*filter":"redirect",":year":"year",":year/report/*filter":"report"},redirect:function(o){var p=e.Years.getLast();if(o){this.navigate(p.toString()+"/report/"+o,{trigger:true})}else{this.navigate(p.toString(),{trigger:true})}},year:function(o){if($.isNumeric(o)){this.navigate(o+"/report/all-entities",{trigger:true})}else{this.navigate("",{trigger:true})}},report:function(q,o){var p=o.split("-");if($.inArray(p[0],["all","entity","type","size"])===-1||p[1]==="none"||p[1]===""){this.navigate(q+"/report/all-entities",{trigger:true})}else{e.Control.set({year:q,report:p[0],id:p[1]});_gaq.push(["_trackEvent","Online-Report",q+"-"+p[0]+"-"+p[1],q+"-"+p[0]+"-"+p[1]]);$("#report").removeClass(function(r,s){return(s.match(/\breport-\S+/g)||[]).join(" ")});$("#report").addClass("report-"+p[0]).addClass("report-id-"+p[1]);e.Overview=e.Overview||new b.Overview();e.Details=e.Details||new b.Details();e.Footer=e.Footer||new b.Footer();e.Overview.update();e.Details.update();e.viewsIntro=e.viewsIntro||new n.Intro({el:$("#intro"),model:new b.Intro()});e.viewsTools=e.viewsTools||new n.Tools({el:$("#tools"),model:e.Control});e.viewsOverview=e.viewsOverview||new n.Overview({el:$("#overview"),model:e.Overview});e.viewsDetails=e.viewsDetails||new n.Details({el:$("#details"),model:e.Details});e.viewsFooter=e.viewsFooter||new n.Footer({el:$("#footer"),model:e.Footer})}}});function c(o){e.Control=new b.Control({updated:new Date(o.Years.updated)});e.Years=new b.Years(o.Years.elements);e.Types=new b.Types(o.Types.elements);e.Sizes=new b.Sizes(o.Sizes.elements);e.Criteria=new b.Criteria(o.Criteria.elements);e.CriteriaGroups=new b.CriteriaGroups(o.CriteriaGroups.elements);e.Records=new b.Records();e.Years.each(function(q){if(q.isActive()){var p=o[q.get("year")].elements;_.each(p,function(r){r.year=q.get("year")});e.Records.add(p)}})}function f(o){c(o);m("onData");e.App=new l.App();Backbone.history.start()}$(function(){if(typeof isdebug==="undefined"||isdebug===false){Tabletop.init({key:d,parseNumbers:true,callback:f,proxy:"https://hrceeo.s3.amazonaws.com"})}else{Tabletop.init({key:d,parseNumbers:true,callback:f})}})});