$(function(){var l="0AjJMRBK0X7j7dGNfXzVDY1VhVGRZb1E2eFJmZU9vY3c";var f="https://docs.google.com/spreadsheet/pub?hl=en_US&hl=en_US&key="+l+"&output=html";var k="http://hrcnz.github.io/hrc-good-employer";var d={};var p={};var n={};var g={};var m={white:{r:255,g:255,b:255},dark:{r:97,g:97,b:97},medium:{r:160,g:160,b:160},light:{r:210,g:210,b:210},lighter:{r:237,g:237,b:237},all:{r:115,g:28,b:31},all_light:{r:210,g:164,b:166},entity:{r:36,g:173,b:162},entity_light:{r:203,g:227,b:225},type:{r:163,g:185,b:64},type_light:{r:220,g:227,b:179},size:{r:36,g:98,b:132},size_light:{r:185,g:195,b:212}};var b="The Human Rights Commission reviews and analyses the reporting of good employer obligations by Crown entities in their annual reports. It also monitors their progress towards equal employment opportunities (EEO) and provides good employer guidance. The Commission's annual good employer review gives Crown entities an indicator report showing their reporting progress. A new web application also allows Crown entities to track their own progress across years, and compare with other Crown entities of the same size, type and the sector as a whole.";var j="978-0-478-35664-9";d.Control=Backbone.Model.extend({color:function(t,q){t=typeof t!=="undefined"?t:false;q=typeof q!=="undefined"?q:false;var r=this.get("report");var s;if(r==="all"){s=t?m.all_light:m.all}else{if(r==="entity"){s=t?m.entity_light:m.entity}else{if(r==="type"){s=t?m.type_light:m.type}else{if(r==="size"){s=t?m.size_light:m.size}}}}return q?i(s):s},accordionCloseAll:function(){$(".accordion").removeClass("open");$(".accordion-bottom").slideUp();$(".accordion-top").attr("aria-expanded",false);$(".accordion-top").attr("aria-selected",false);$(".accordion-bottom").attr("aria-expanded",false);$(".accordion-bottom").attr("aria-hidden",true);$("a.accordion-open").attr("aria-hidden",false);$("a.accordion-false").attr("aria-hidden",true)}});d.Year=Backbone.Model.extend({initialize:function(){this.set("summaryoverview",this.get("summaryoverview").replace(/[^\u0000-\u007E]/g," ").replace("  "," ").replace("0",""));this.set("summarygeref",this.get("summarygeref").replace(/[^\u0000-\u007E]/g," ").replace("  "," ").replace("0",""));this.set("summaryeeoref",this.get("summaryeeoref").replace(/[^\u0000-\u007E]/g," ").replace("  "," ").replace("0",""));this.set("summarygeelements",this.get("summarygeelements").replace(/[^\u0000-\u007E]/g," ").replace("  "," ").replace("0",""));this.set("summaryreview",this.get("summaryreview").replace(/[^\u0000-\u007E]/g," ").replace("  "," ").replace("0",""));this.set("summarywp",this.get("summarywp").replace(/[^\u0000-\u007E]/g," ").replace("  "," ").replace("0",""));this.set("summaryparticipation",this.get("summaryparticipation").replace(/[^\u0000-\u007E]/g," ").replace("  "," ").replace("0",""))},isActive:function(){return(this.get("active"))==="TRUE"?true:false}});d.Years=Backbone.Collection.extend({model:d.Year,initialize:function(){this.sort_key="year"},byYear:function(r){var q=this.filter(function(s){return s.get("year")===r});return new d.Years(q)},byYears:function(r){var q=this.filter(function(s){return($.inArray(s.get("year").toString(),r)>-1)});return new d.Years(q)},comparator:function(r,q){r=r.get(this.sort_key);q=q.get(this.sort_key);return r<q?1:r>q?-1:0},getLast:function(){this.active().sort();return this.first().get("year")},getFirst:function(){this.active().sort();return this.last().get("year")},active:function(){var q=this.filter(function(r){return r.isActive()});return new d.Years(q)}});d.Type=Backbone.Model.extend({});d.Types=Backbone.Collection.extend({model:d.Type,initialize:function(){this.sort_key="title";this.sort_dir="asc"},byRecords:function(q){var r=this.filter(function(s){return(q.hasType(s.get("id")))});return new d.Types(r)},comparator:function(r,q){var s=this.sort_dir==="asc"?1:-1;r=r.get(this.sort_key).toLowerCase();q=q.get(this.sort_key).toLowerCase();return s*((r>q)?1:(r<q)?-1:0)},sortBy:function(q,r){r=typeof r!=="undefined"?r:"asc";this.sort_key=q;this.sort_dir=r;return this.sort()}});d.Size=Backbone.Model.extend({});d.Sizes=Backbone.Collection.extend({model:d.Size,bySize:function(q){var r=this.filter(function(s){return(Math.ceil(q)>=s.get("min")&&Math.ceil(q)<=s.get("max"))});return new d.Sizes(r)},byRecords:function(q){var r=this.filter(function(s){return(q.hasSize(s.get("min")))});return new d.Sizes(r)}});d.Criterion=Backbone.Model.extend({initialize:function(){this.set("id",this.get("id").replace("_",""))}});d.Criteria=Backbone.Collection.extend({model:d.Criterion,getMax:function(){return this.length},byGroup:function(r){var q=this.filter(function(s){return s.get("criteriongroupid")===r});return new d.Criteria(q)}});d.CriteriaGroup=Backbone.Model.extend({initialize:function(){this.count_criteria()},count_criteria:function(){var r=0;var q=this;g.Criteria.each(function(s){if(s.get("criteriongroupid")===q.get("id")){r++}});this.count=r}});d.CriteriaGroups=Backbone.Collection.extend({model:d.CriteriaGroup});d.Record=Backbone.Model.extend({initialize:function(){this.set("typeid",this.get("typeid").trim());this.set("summaryoverview",this.get("summaryoverview").toString().replace(/[^\u0000-\u007E]/g," ").replace("  "," ").replace("0",""));if(this.get("staffno")===""){this.set("staffno",0)}if(this.get("type")===""){this.set("type","NS")}},isActive:function(q){q=typeof q!=="undefined"?q:true;return(this.get("active"))==="TRUE"?true:!q},getScore:function(s){s=typeof s!=="undefined"?s:false;var r=0;var q=this;g.Criteria.each(function(t){r+=q.getCriterionScore(t.id)});if(s){return Math.round((r/g.Criteria.getMax())*100)}else{return r}},getCriterionScore:function(q){return($.isNumeric(this.get(q)))?this.get(q):0},getGroupScore:function(q,u){u=typeof u!=="undefined"?u:false;var t=0;var s=0;var r=this;g.Criteria.each(function(v){if(v.get("criteriongroupid")===q){t+=r.getCriterionScore(v.id);s++}});if(u){return Math.round((t/s)*100)}else{return t}},getRank:function(){return g.Records.byScore(this.get("year"),this.getScore()).length+1},getScoreChange:function(s,r){s=typeof s!=="undefined"?s:false;r=typeof r!=="undefined"?r:this.get("year")-1;var q=g.Records.byEntity(this.get("entityid")).byYear(r).models[0];if(typeof q!=="undefined"){return this.getScore(s)-q.getScore(s)}else{return false}},getRankChange:function(r){r=typeof r!=="undefined"?r:this.get("year")-1;var q=g.Records.byEntity(this.get("entityid")).byYear(r).models[0];if(typeof q!=="undefined"){return -1*(this.getRank()-q.getRank())}else{return false}},getStaffNo:function(){return this.get("staffno")},getTypeTitle:function(){return g.Types.findWhere({id:this.get("typeid")}).get("title")},getStaffTitle:function(){return(this.get("staffno")>0)?this.get("staffno"):"Not specified"},getStaffCatTitle:function(){return g.Sizes.bySize(this.get("staffno")).first().get("title")},getSummary:function(){return(this.get("summaryoverview")!=="")?this.get("summaryoverview"):g.Years.byYear(this.get("year")).models[0].get("summaryoverview")}});d.Records=Backbone.Collection.extend({model:d.Record,initialize:function(){this.sort_key="title";this.sort_dir="asc"},comparator:function(r,q){var s=this.sort_dir==="asc"?1:-1;if(this.sort_key==="score"){r=r.getScore();q=q.getScore();return s*((r>q)?1:(r<q)?-1:0)}else{if(this.sort_key==="year"){r=r.get(this.sort_key);q=q.get(this.sort_key);return s*((r>q)?1:(r<q)?-1:0)}else{r=r.get(this.sort_key).toLowerCase();q=q.get(this.sort_key).toLowerCase();return s*((r>q)?1:(r<q)?-1:0)}}},sortBy:function(q,r){r=typeof r!=="undefined"?r:"asc";this.sort_key=q;this.sort_dir=r;return this.sort()},active:function(){var q=this.filter(function(r){return r.isActive()});return new d.Records(q)},byYear:function(s,r){r=typeof r!=="undefined"?r:true;var q=this.filter(function(t){return t.isActive(r)&&t.get("year")===s});return new d.Records(q)},byEntity:function(q,s){s=typeof s!=="undefined"?s:true;var r=this.filter(function(t){return t.isActive(s)&&t.get("entityid").toString()===q.toString()});return new d.Records(r)},byType:function(s,r){r=typeof r!=="undefined"?r:true;var q=this.filter(function(t){return t.isActive(r)&&t.get("typeid")===s});return new d.Records(q)},hasType:function(q){return typeof this.findWhere({typeid:q})!=="undefined"},hasSize:function(q){return this.bySize(q).length>0},bySize:function(q,s){s=typeof s!=="undefined"?s:true;var r=this.filter(function(u){var v=0;var t=0;g.Sizes.each(function(w){if(Math.ceil(q)>=w.get("min")&&Math.ceil(q)<=w.get("max")){v=w.get("min");t=w.get("max")}});return u.isActive(s)&&Math.ceil(u.getStaffNo())>=v&&Math.ceil(u.getStaffNo())<=t});return new d.Records(r)},byScore:function(u,s,q,t){q=typeof q!=="undefined"?q:0;t=typeof t!=="undefined"?t:true;var r=this.filter(function(v){if(q!==0){return v.isActive(t)&&v.getScore()>s&&v.getScore()<=q&&v.get("year")===u}else{return v.isActive(t)&&v.getScore()>s&&v.get("year")===u}});return new d.Records(r)},getResults:function(q){var u={criterion:"all",group:"all"};var t=$.extend({},u,q);var r={};var s;if(t.criterion!=="all"){s=1}else{if(t.group!=="all"){s=g.CriteriaGroups.where({id:t.group})[0].count}else{s=g.Criteria.length}}this.sortBy("year").each(function(v){if(v.isActive()){var w=v.get("year");if(w in r){if(t.criterion!=="all"){r[w].score+=v.getCriterionScore(t.criterion)}else{if(t.group!=="all"){r[w].score+=v.getGroupScore(t.group)}else{r[w].score+=v.getScore()}}r[w].count++}else{r[w]={};r[w].year=w;if(t.criterion!=="all"){r[w].score=v.getCriterionScore(t.criterion)}else{if(t.group!=="all"){r[w].score=v.getGroupScore(t.group)}else{r[w].score=v.getScore()}}r[w].count=1}r[w].percentage=Math.round(((r[w].score/r[w].count)/s)*100)}});return r}});d.Intro=Backbone.Model.extend({initialize:function(){this.minYear=g.Years.getFirst();this.maxYear=g.Years.getLast();this.title="Crown Entities and the Good Employer";this.subtitle="Annual Report Review "+this.minYear+" to "+this.maxYear;this.summary=b}});p.Intro=Backbone.View.extend({initialize:function(){this.render()},render:function(){this.$el.html(this.template(this.model));return this},template:_.template('<div class="row">\n<div class="col-left">\n<h1 id="intro-title"><%= title %></h1>\n<h2><%= subtitle %></h2>\n<div class="summary"><p><%= summary %></p></div>\n</div>\n<div class="col-right">\n<a class="home-link" href="#" title="Reset Application: Crown Entities and the Good Employer"></a>\n</div>\n</div>'),renderPdf:function(q){console.log("intro.renderpdf");q.addText(this.model.title,"intro_title");q.addText(this.model.subtitle,"intro_subtitle");q.addText(this.model.summary,"intro_summary");q.addLine("intro_line");q.addImage("intro_logo","intro_logo")}});p.Tools=Backbone.View.extend({initialize:function(){this.render();this.listenTo(this.model,"change",this.render)},render:function(){var q=g.Records.byYear(parseInt(this.model.get("year")));var r=g.Years.active();if(this.model.get("report")==="entity"){r=r.byYears(Object.keys(g.Records.byEntity(this.model.get("id")).getResults()))}else{if(this.model.get("report")==="size"){r=r.byYears(Object.keys(g.Records.bySize(this.model.get("id")).getResults()))}else{if(this.model.get("report")==="type"){r=r.byYears(Object.keys(g.Records.byType(this.model.get("id")).getResults()))}}}var s={entities:q.models,types:g.Types.byRecords(q).sort().models,sizes:g.Sizes.byRecords(q).models,years:r.models,allActive:(this.model.get("report")==="all")?"active":"",entityActiveID:(this.model.get("report")==="entity")?this.model.get("id"):"",typeActiveID:(this.model.get("report")==="type")?this.model.get("id"):"",sizeActiveMin:(this.model.get("report")==="size")?this.model.get("id"):-1,yearActive:parseInt(this.model.get("year"))};this.$el.html(this.template($.extend(s,{select_width:178})));this.$("select#entity").select2({placeholder:"Entity",allowClear:true});this.$("select#type").select2({placeholder:"Type",allowClear:true,minimumResultsForSearch:99});this.$("select#size").select2({placeholder:"Size",allowClear:true,minimumResultsForSearch:99});this.$("select#year").select2({minimumResultsForSearch:99});this.initFullscreen();return this},events:{"click #all":"selectAll","click #renderPdf":"renderPdf","change #entity":"selectEntity","change #type":"selectType","change #size":"selectSize","change #year":"selectYear"},selectAll:function(q){q.preventDefault();g.App.navigate(this.model.get("year")+"/report/all-entities",{trigger:true})},selectEntity:function(q){q.preventDefault();g.App.navigate(this.model.get("year")+"/report/entity-"+this.$("#entity").val(),{trigger:true})},selectType:function(q){q.preventDefault();g.App.navigate(this.model.get("year")+"/report/type-"+this.$("#type").val(),{trigger:true})},selectSize:function(q){q.preventDefault();g.App.navigate(this.model.get("year")+"/report/size-"+this.$("#size").val(),{trigger:true})},selectYear:function(q){q.preventDefault();g.App.navigate(this.$("#year").val()+"/report/"+this.model.get("report")+"-"+this.model.get("id"),{trigger:true})},renderPdf:function(q){q.preventDefault();c()},template:_.template('<div class="row">\n  <h3 id="tools-title" class="medium pull-left">Select a report for a specific entity or a group of entities</h3>\n  <div aria-hidden="true" role="presentation">\n    <a href="#" class="fullscreen hidden-fullscreen hidden-standalone pull-right" data-toggle="fullscreen">Enter fullscreen <span class="icon-fullscreen-open"></span></a>    <a href="#" class="fullscreen visible-fullscreen hidden-standalone pull-right" data-toggle="fullscreen-close">Exit fullscreen <span class="icon-fullscreen-close"></span></a>\n  </div>\n</div>\n<div class="row" id="report-select"><button role="button" id="all" class="btn <%= allActive %>" aria-pressed="<%if (allActive === "active") { %>true<% } else { %>false<% } %>" >All entities</button><select id="entity" class="select2" style="width:<%=select_width%>px;">  <option></option>  <% var group_label = "A"; %>\n  <optgroup label="<%=group_label%>">\n  <%_.forEach(entities, function (entity) {%>\n    <% if (entity.get("title").charAt(0).toUpperCase() !== group_label) { %>\n    <% group_label = entity.get("title").charAt(0).toUpperCase();  %>\n    </optgroup><optgroup label="<%=group_label%>">\n    <% }  %>\n    <option value="<%= entity.get("entityid") %>" <% if (entity.get("entityid").toString() === entityActiveID.toString()) { print ("selected") } %> >    <%= entity.get("title") %></option>  <%})%>  </optgroup>\n</select><select id="type" class="select2" style="width:<%=select_width%>px;">  <option></option>  <% _.forEach(types, function (type) {%>    <option value="<%= type.get("id") %>" <% if (type.get("id") === typeActiveID) { print ("selected") } %> >    <%= type.get("title") %></option>  <%})%></select><select id="size" class="select2" style="width:<%=select_width%>px;">  <option></option>  <% _.forEach(sizes, function (size) {%>    <option value="<%= size.get("min") %>" <% if (size.get("min") <= sizeActiveMin && size.get("max") >= sizeActiveMin) { print ("selected") } %> >    <%= size.get("title") %></option>  <%})%></select><select id="year" class="select2">  <% _.forEach(years, function (year) {%>    <option value="<%= year.get("year") %>" <% if (parseInt(year.get("year")) === yearActive) { print ("selected") } %>>    <%= year.get("year") %></option>  <%})%></select></div><!--[if gt IE 8]><!-->\n<div aria-labelledby="renderPdf" class="row"><a title="Download a pdf-version of the current report" href="#" id="renderPdf" class="pull-right">Download a pdf-version of selected report <span class="icon-download"></span></a></div><!--<![endif]-->\n'),initFullscreen:function(){if(top!==self){$("body").removeClass("standalone");var s=fullScreenApi.isFullScreen(),q;$(window).on("resize",function(){clearTimeout(q);q=setTimeout(r,300)});function r(){if(s!==fullScreenApi.isFullScreen()){if(s){$("body").removeClass("fullscreen")}else{$("body").addClass("fullscreen")}s=fullScreenApi.isFullScreen()}if(top===self){$("body").addClass("standalone")}}$("a[data-toggle='fullscreen']").attr("href",k);$("a[data-toggle='fullscreen']").click(function(u){var t=/webkit/.test(navigator.userAgent.toLowerCase());if(top!==self&&fullScreenApi.supportsFullScreen&&!t){u.preventDefault();$("html").requestFullScreen()}});$("a[data-toggle='fullscreen-close']").click(function(t){if(top!==self&&fullScreenApi.supportsFullScreen){t.preventDefault();$("html").cancelFullScreen()}})}}});d.Overview=Backbone.Model.extend({initialize:function(){this.set("updated",0);this.set("resultsAll",g.Records.getResults());this.resetFields()},update:function(){this.currentYear=parseInt(g.Control.get("year"));this.currentYearData=g.Years.byYear(this.currentYear).first();this.currentCount=this.get("resultsAll")[this.currentYear].count;this.set({year:this.currentYear,graphCollectionActive:null,graphCollection:g.Records.byYear(this.currentYear).sortBy("title","desc").sortBy("score","asc")});this.resetFields();if(g.Control.get("report")==="all"){this.set({title:"All entities",subtitle:"This report provides an overview of the compliance of all Crown entities",score:this.get("resultsAll")[this.currentYear].percentage,score_label:"Average compliance",rank_label:"Total number of Crown entities",rank:this.currentCount,summary:this.currentYearData.get("summaryoverview"),modelAverages:new d.Averages({}),modelAveragesTime:new d.AveragesTime({all:this.get("resultsAll")})});if(typeof this.get("resultsAll")[this.currentYear-1]!=="undefined"){var B=this.get("resultsAll")[this.currentYear].percentage-this.get("resultsAll")[this.currentYear-1].percentage;this.set("score_change",B);this.set("score_change_class",B>0?"up":B<0?"down":"same")}}else{if(g.Control.get("report")==="entity"){var C=g.Control.get("id");var r=g.Records.byEntity(C);var z=r.byYear(this.currentYear);if(z.length===0){}else{this.set("graphCollectionActive",z);var u=this.get("graphCollectionActive").first();var x=g.Records.byType(u.get("typeid")).getResults();var D=g.Records.bySize(u.getStaffNo()).getResults();var A="";var w="";if(u.getScoreChange(true)!==false){A=u.getScoreChange(true);w=A>0?"up":A<0?"down":"same"}var F="";var t="";if(u.getRankChange()!==false){F=u.getRankChange();t=F>0?"up":F<0?"down":"same"}this.set({modelAverages:new d.Averages({all:this.get("resultsAll")[this.currentYear].percentage,type:x[this.currentYear].percentage,size:D[this.currentYear].percentage}),modelAveragesTime:new d.AveragesTime({all:this.get("resultsAll"),type:x,size:D,entity:r.getResults(),type_label:"Same type: "+u.getTypeTitle(),size_label:"Same size: "+u.getStaffCatTitle(),entity_label:"Entity: "+u.get("title")})});this.set({title:u.get("title"),subtitle:u.get("explanation"),type_label:"Type",type:u.getTypeTitle(),type_id:u.get("typeid"),size_label:"Size",size:u.getStaffCatTitle(),size_id:u.getStaffNo(),score:u.getScore(true),score_change:A,score_change_class:w,rank_label:"Rank",rank:u.getRank(),rank_of:" of "+this.currentCount+" entities",rank_change:F,rank_change_class:t,summary:u.getSummary()})}}else{if(g.Control.get("report")==="type"||g.Control.get("report")==="size"){var y,q,s;if(g.Control.get("report")==="type"){var v=g.Control.get("id");y=g.Types.findWhere({id:v});q=g.Records.byType(v);s=q.getResults();this.set({title:"Category: "+y.get("title"),modelAverages:new d.Averages({all:this.get("resultsAll")[this.currentYear].percentage}),modelAveragesTime:new d.AveragesTime({all:this.get("resultsAll"),type:s,type_label:y.get("title")})})}else{if(g.Control.get("report")==="size"){var E=g.Control.get("id");y=g.Sizes.bySize(E).first();q=g.Records.bySize(E);s=q.getResults();this.set({title:"Category: "+y.get("title"),modelAverages:new d.Averages({all:this.get("resultsAll")[this.currentYear].percentage}),modelAveragesTime:new d.AveragesTime({all:this.get("resultsAll"),size:s,size_label:(y.get("title"))})})}}this.set({graphCollectionActive:q.byYear(this.currentYear),subtitle:"This report provides an overview of the compliance of selected category",score_label:"Average compliance",score:s[this.currentYear].percentage,rank_label:"Number of entities in category",rank:q.byYear(this.currentYear).length,rank_of:" of "+this.currentCount+" entities total",rank_change:"",summary:this.currentYearData.get("summaryoverview")});if(typeof s[this.currentYear-1]!=="undefined"){var B=s[this.currentYear].percentage-s[this.currentYear-1].percentage;this.set("score_change",B);this.set("score_change_class",B>0?"up":B<0?"down":"same")}}}}this.set("report",g.Control.get("report"));this.set("updated",g.Control.get("report")+g.Control.get("id")+g.Control.get("year"))},resetFields:function(){this.set({title:"",subtitle:"",type_label:"",type:"",size_label:"",size:"",score_label:"Overall compliance",score:"",score_change:"",score_change_class:"",rank_label:"",rank:"",rank_of:"",rank_change:"",rank_change_class:"",summary:""})}});p.Overview=Backbone.View.extend({initialize:function(){this.subviews={};this.render();this.listenTo(this.model,"change:updated",this.render)},events:{"click .accordion-toggle":"accordionToggle","click .load-report":"loadReport"},loadTitle:function(q){q.preventDefault();g.App.navigate(g.Control.get("year")+"/report/"+$(q.currentTarget).data("report"),+"-",+$(q.currentTarget).data("reportid"),{trigger:true})},accordionToggle:function(q){q.preventDefault();if(this.$(".accordion").hasClass("open")){this.accordionClose()}else{g.Control.accordionCloseAll();this.accordionOpen()}},accordionOpen:function(){var q=this;this.$(".accordion-bottom").slideDown(function(){q.$(".accordion").addClass("open");q.$(".accordion-top").attr("aria-expanded",true);q.$(".accordion-top").attr("aria-selected",true);q.$(".accordion-bottom").attr("aria-expanded",true);q.$(".accordion-bottom").attr("aria-hidden",false);q.$("button.accordion-open").attr("aria-hidden",true);q.$("button.accordion-false").attr("aria-hidden",false)})},accordionClose:function(){var q=this;this.$(".accordion-bottom").slideUp(function(){q.$(".accordion").removeClass("open");q.$(".accordion-top").attr("aria-expanded",false);q.$(".accordion-top").attr("aria-selected",false);q.$(".accordion-bottom").attr("aria-expanded",false);q.$(".accordion-bottom").attr("aria-hidden",true);q.$("button.accordion-open").attr("aria-hidden",false);q.$("button.accordion-false").attr("aria-hidden",true)})},render:function(){this.$el.html(this.template(this.model.attributes));this.subviews.graphView=new p.OverviewGraph({collection:this.model.get("graphCollection"),collectionActive:this.model.get("graphCollectionActive"),axis_label:"Compliance",average_line:this.model.get("score")});this.$("#overview-graph").append(this.subviews.graphView.render().el);this.subviews.graphView.renderGraph();this.subviews.averagesView=new p.Averages({model:this.model.get("modelAverages")});this.$(".averages-panel").append(this.subviews.averagesView.render().el);this.subviews.averagesGraphView=new p.AveragesTimeGraph({model:this.model.get("modelAveragesTime"),marker:false});this.$("#overview-time-graph").append(this.subviews.averagesGraphView.render().el);this.subviews.averagesGraphView.renderGraph();return this},template:_.template('<div id="overview-title" class="row" >\n  <div class="col-left">\n    <h2 id="overview-the-title" aria-label="Current report: Name of selected entity or entity group" ><%= title %></h2>\n    <% if (subtitle !== "") { %>\n    <h3 aria-label="Additional information" class="medium"><%= subtitle %></h3>\n    <% } %>\n</div>\n<div class="col-right">\n<div aria-label="Year for current report" class="year active"><%= year %></div>\n</div>\n</div><!-- #overview-title -->\n<div id="overview-cat" class="row">\n<% if (type !== "") {%>\n  <div>\n    <span class="label"><%= type_label %> </span>\n    <span><a class="load-report" data-report="type" data-reportid="<%= type_id %>" href="#<%= year %>/report/type-<%= type_id %>" title="Load Report: <%= type %>"><%= type %></a></span>\n  </div>\n<% } %>\n<% if (size !== "") {%>\n  <div>\n    <span class="label"><%= size_label %> </span>\n    <span><a class="load-report" data-report="size" data-reportid="<%= size_id %>" href="#<%= year %>/report/size-<%= size_id %>" title="Load Report: <%= size %>"><%= size %></a></span>\n  </div>\n<% } %>\n</div><!-- #overview-cat -->\n<div id="overview-graph"></div><!-- #overview-graph -->\n<div id="overview-bottom" role="tablist">\n  <div class="accordion open" >\n    <div class="accordion-top row" role="tab" aria-expanded="true" aria-selected="true">\n      <a href="#" aria-hidden="true" role="button" class="accordion-open accordion-toggle icon-accordion-toggle" title="Show more" aria-label="Show more"></a>\n      <a href="#" aria-hidden="false" role="button" class="accordion-close accordion-toggle icon-accordion-toggle" title="Show less" aria-label="Show less"></a>\n      <div class="col-left">\n        <div class="score-panel">\n          <div class="score-label"><%= score_label %></div>\n          <div class="score active"><%= score %>%</div>\n          <% if (score_change !== "") {%>\n            <div class="score-change active" aria-label="Change of score compared with last year"><div class="icon-trend <%= score_change_class %>"></div>\n            <% if (score_change > 0) {%>+<%}%><%= score_change %>%\n            </div>\n          <%}%>\n        </div>\n      </div>\n      <div class="col-right">\n        <div class="averages-panel"></div>\n      </div>\n    </div>\n    <div class="accordion-bottom row" role="tabpanel" aria-expanded="true" aria-hidden="false">\n      <div class="col-left">\n        <div class="rank-panel">\n          <div class="rank-label"><%= rank_label %></div>\n          <div class="rank active"><span class="the-rank"><%= rank %></span><span class="rank-of"><%= rank_of %></span></div>\n          <% if (rank_change !== "") {%>\n            <div class="rank-change active" aria-label="Change of score compared with last year"><div class="icon-trend <%= rank_change_class %>"></div>\n              <% if (rank_change > 0) {%>+<%}%><%= rank_change %>\n            </div>\n          <%}%>\n          </div>\n        <div class="summary-panel">\n          <p><%= summary %></p>\n        </div>\n      </div>\n      <div class="col-right">\n        <div id="overview-time-graph"></div><!-- #overview-time-graph -->\n      </div>\n    </div>\n  </div>\n</div><!-- #overview-bottom -->    '),renderPdf:function(t){var r=g.Control.color();console.log("overview.renderpdf");var v=0;var u=0;t.addText(this.model.get("year").toString(),"overview_year",{color:r});v+=t.addText(this.model.get("title"),"overview_title");v+=t.addText(this.model.get("subtitle"),"overview_subtitle",{offy:v});if(this.model.get("report")==="entity"){t.addText(this.model.get("type_label"),"overview_type_label",{offy:v});t.addText(this.model.get("type"),"overview_type",{offy:v});t.addText(this.model.get("size_label"),"overview_size_label",{offy:v});t.addText(this.model.get("size"),"overview_size",{offy:v})}t.addText(this.model.get("score_label"),"overview_score_label");t.addText(this.model.get("score").toString()+"%","overview_score",{color:r});var q=this.model.get("score_change");if(q!==""){if(q<0){q=q.toString()+"%";t.addImage("overview_"+this.model.get("report")+"_down","overview_score_trend")}else{if(q>0){q="+"+q.toString()+"%";t.addImage("overview_"+this.model.get("report")+"_up","overview_score_trend")}else{if(q===0){q=q.toString()+"%";t.addImage("overview_"+this.model.get("report")+"_same","overview_score_trend")}}}}t.addText(q,"overview_score_change",{color:r});t.addLine("overview_score_line");t.addText(this.model.get("rank_label"),"overview_rank_label");t.addText(this.model.get("rank").toString(),"overview_rank",{color:r});if(this.model.get("rank")<10){u=-5}t.addText(this.model.get("rank_of"),"overview_rank_of",{color:r,offx:u});var s=this.model.get("rank_change");if(s!==""){if(s<0){s=s.toString();t.addImage("overview_"+this.model.get("report")+"_down","overview_rank_trend")}else{if(s>0){s="+"+s.toString();t.addImage("overview_"+this.model.get("report")+"_up","overview_rank_trend")}else{if(s>0){s=s.toString();t.addImage("overview_"+this.model.get("report")+"_same","overview_rank_trend")}}}}t.addText(s,"overview_rank_change",{color:r});t.addLine("overview_rank_line");this.subviews.graphView.renderPdf(t);this.subviews.averagesGraphView.renderPdf(t,"averages_graph");if(this.model.get("modelAverages").get("all")>-1){this.subviews.averagesView.renderPdf(t,"overview_averages");t.addText(this.model.get("summary"),"overview_summary")}else{t.addText(this.model.get("summary"),"overview_summary",{offy:-15})}}});p.OverviewGraph=Backbone.View.extend({initialize:function(q){this.options=q||{};this.currentIndex=-99;this.ticks=[[0,"0%"],[25,"25%"],[50,"50%"],[75,"75%"],[100,"100%"]]},events:{"plotclick .overview-plot":"plotclick","plothover .overview-plot":"plothover"},attributes:{"class":"overview-graph row"},plotOptions:{yaxis:{tickColor:i(m.dark),color:i(m.dark),min:0,max:100,position:"right",tickLength:5,font:{color:i(m.dark),size:13}},xaxis:{tickColor:i(m.dark),show:false},legend:{show:false},grid:{hoverable:true,clickable:true,autoHighlight:true,backgroundColor:"#ffffff",show:true,aboveData:false,margin:0,labelMargin:10,markings:[],borderWidth:{top:0,right:1,bottom:1,left:0},borderColor:i(m.dark),color:i(m.dark),minBorderMargin:0,axisMargin:0},series:{shadowSize:0,bars:{show:true,fill:1,barWidth:1,align:"center",lineWidth:1}}},render:function(){this.$el.html(this.template({axis_label:this.options.axis_label}));return this},renderGraph:function(){var z=_.clone(this.plotOptions);z.yaxis.ticks=this.ticks;var u=[];var t=[];var x=[];var s=[];var r=[];z.colors=[];z.colors.push("#ffffff");z.colors.push(g.Control.color(true,true));z.colors.push("#ffffff");z.colors.push(g.Control.color(false,true));z.xaxis.min=-1.5;z.xaxis.max=this.collection.length+1.5;var y=this.$(".overview-plot-table table tbody");y.append('<tr><th scope="col">Entity</th><th scope="col">Compliance in %</th></tr>');for(var v=0;v<this.collection.length;v++){var w=this.collection.models[v];if(w.getScore(true)===0){x.push([v,w.getScore(true)])}u.push([v,w.getScore(true)]);if(this.options.collectionActive!==null){var q=this.options.collectionActive.findWhere({entityid:w.get("entityid")});if(typeof q!=="undefined"){if(w.getScore(true)===0){s.push([v,w.getScore(true)])}r.push([v,q.getScore(true)]);y.append("<tr><td>Entity (active): "+w.get("title")+"</td><td>"+w.getScore(true)+"%</td></tr>")}else{r.push([v,null])}}else{y.append("<tr><td>Entity (other): "+w.get("title")+"</td><td>"+w.getScore(true)+"%</td></tr>")}}t.push({data:u,bars:{fillColor:g.Control.color(true,true)},highlightColor:i(m.all)});t.push({data:x,points:{show:true},bars:{show:false},highlightColor:i(m.all)});t.push({data:r,bars:{fillColor:g.Control.color(false,true)},highlightColor:i(m.all)});t.push({data:s,points:{show:true},bars:{show:false},highlightColor:i(m.all)});if(g.Control.get("report")!=="entity"){t.push({data:[[-1,this.options.average_line],[this.collection.length,this.options.average_line]],lines:{show:true,lineWidth:1},bars:{show:false}});if(g.Control.get("report")==="all"){z.colors.push(i(m.all))}else{if(g.Control.get("report")==="type"){z.colors.push(i(m.type))}else{if(g.Control.get("report")==="size"){z.colors.push(i(m.size))}}}}this.plot=$.plot(this.$(".overview-plot"),t,z)},renderPdf:function(s){s.addPlot(this.plot.getCanvas(),"overview_graph");s.addText(this.options.axis_label,"overview_graph_axis_label");var r=s.item("overview_graph");for(var q=0;q<this.ticks.length;q++){s.addText(this.ticks[this.ticks.length-1-q][1],"overview_graph_ticks",{offy:r.h*0.92/(this.ticks.length-1)*q})}},plotclick:function(r,s,q){console.log("plotclick");r.preventDefault();if(q){g.App.navigate(g.Control.get("year")+"/report/entity-"+this.collection.models[q.dataIndex].get("entityid"),{trigger:true})}},plothover:function(t,w,s){var q,u;if(this.hoverTip){this.hoverTip.remove()}if(s){document.body.style.cursor="pointer";var v=s.dataIndex/this.collection.length;var r=this.collection.models[s.dataIndex];this.hoverTip=$(this.toolTipHTML(s.series.data[s.dataIndex],r,(v*100)));this.$(".overview-plot").parent().append(this.hoverTip);q=this.hoverTip.outerHeight();u=this.hoverTip.outerWidth();if(this.collection.models[s.dataIndex].getScore()===0){this.hoverTip.offset({left:s.pageX-u*v,top:s.pageY-q-15})}else{this.hoverTip.offset({left:s.pageX-u*v,top:s.pageY-q-5})}}else{document.body.style.cursor="default"}},toolTipHTML:function(s,r,t){var q="";q+='<div class="tooltip tooltip-overview">';q+='<div class="tooltip-inner-wrap">';if(r){q+='<div class="series"><strong>'+r.get("title")+"</strong></div>"}q+='<div class="stats">Compliance: '+s[1]+"%</div>";q+='<div class="stats">Rank: '+r.getRank()+"</div>";q+="</div>";q+="</div>";q+="</div>";q+="<style>.tooltip:after {left:"+t+"%;}</style>";return q},template:_.template('<div class="plot-wrapper">\n<div aria-hidden="true" role="presentation" class="yaxis-label"><%= axis_label %></div>\n<div aria-label="Compliance of all entities - Chart. Details in the following table" role="img" class="overview-plot"></div>\n<div class="overview-plot-table sr-only">\n<summary>Compliance of all entities - Table</summary>\n<table>\n<caption>Compliance of all entities, active entities highlighted</caption>\n<tbody>\n</tbody>\n</table>\n</div>\n</div>')});d.Details=Backbone.Model.extend({initialize:function(){this.set("updated",0);this.results={};this.results.all=g.Records.getResults();this.results.all_geref=g.Records.getResults({criterion:"geref"});this.results.all_ge=g.Records.getResults({group:"GE"});this.results.all_wp=g.Records.getResults({group:"WP"});this.results.all_eeoref=g.Records.getResults({criterion:"eeoref"});this.results.all_review=g.Records.getResults({criterion:"review"});this.results.all_participation=g.Records.getResults({criterion:"participation"});this.resetFields()},update:function(){this.currentYear=parseInt(g.Control.get("year"));this.currentYearData=g.Years.byYear(this.currentYear).first();this.currentCount=this.results.all[this.currentYear].count;this.resetFields();var t={geref:{},ge:{},eeoref:{},review:{},wp:{},participation:{}};var v,u;var w=this;if(g.Control.get("report")==="entity"){var y=g.Control.get("id");var q=g.Records.byEntity(y);var x=q.byYear(this.currentYear);if(x.length===0){}else{var r=x.first();u=g.Records.byType(r.get("typeid"));v=g.Records.bySize(r.getStaffNo());t.geref.entity=q.getResults({criterion:"geref"});t.ge.entity=q.getResults({group:"GE"});t.ge.entity_elements=[];_.each(g.Criteria.byGroup("GE").models,function(A){t.ge.entity_elements.push({id:A.get("id"),title:A.get("title"),results:x.getResults({criterion:A.get("id")})})});t.wp.entity=q.getResults({group:"WP"});t.wp.entity_elements=[];_.each(g.Criteria.byGroup("WP").models,function(A){t.wp.entity_elements.push({id:A.get("id"),title:A.get("title"),results:x.getResults({criterion:A.get("id")})})});t.eeoref.entity=q.getResults({criterion:"eeoref"});t.review.entity=q.getResults({criterion:"review"});t.participation.entity=q.getResults({criterion:"participation"})}}else{if(g.Control.get("report")==="type"){var s=g.Control.get("id");u=g.Records.byType(s)}else{if(g.Control.get("report")==="size"){var z=g.Control.get("id");v=g.Records.bySize(z)}}}t.geref.all=this.results.all_geref;t.ge.all=this.results.all_ge;t.ge.all_elements=[];_.each(g.Criteria.byGroup("GE").models,function(A){t.ge.all_elements.push({id:A.get("id"),title:A.get("title"),results:g.Records.byYear(w.currentYear).getResults({criterion:A.get("id")})})});t.wp.all=this.results.all_wp;t.wp.all_elements=[];_.each(g.Criteria.byGroup("WP").models,function(A){t.wp.all_elements.push({id:A.get("id"),title:A.get("title"),results:g.Records.byYear(w.currentYear).getResults({criterion:A.get("id")})})});t.eeoref.all=this.results.all_eeoref;t.review.all=this.results.all_review;t.participation.all=this.results.all_participation;if(typeof u!=="undefined"){t.geref.type=u.getResults({criterion:"geref"});t.ge.type=u.getResults({group:"GE"});t.ge.type_elements=[];_.each(g.Criteria.byGroup("GE").models,function(A){t.ge.type_elements.push({id:A.get("id"),title:A.get("title"),results:u.byYear(w.currentYear).getResults({criterion:A.get("id")})})});t.wp.type=u.getResults({group:"WP"});t.wp.type_elements=[];_.each(g.Criteria.byGroup("WP").models,function(A){t.wp.type_elements.push({id:A.get("id"),title:A.get("title"),results:u.byYear(w.currentYear).getResults({criterion:A.get("id")})})});t.eeoref.type=u.getResults({criterion:"eeoref"});t.review.type=u.getResults({criterion:"review"});t.participation.type=u.getResults({criterion:"participation"})}if(typeof v!=="undefined"){t.geref.size=v.getResults({criterion:"geref"});t.ge.size=v.getResults({group:"GE"});t.ge.size_elements=[];_.each(g.Criteria.byGroup("GE").models,function(A){t.ge.size_elements.push({id:A.get("id"),title:A.get("title"),results:v.byYear(w.currentYear).getResults({criterion:A.get("id")})})});t.wp.size=v.getResults({group:"WP"});t.wp.size_elements=[];_.each(g.Criteria.byGroup("WP").models,function(A){t.wp.size_elements.push({id:A.get("id"),title:A.get("title"),results:v.byYear(w.currentYear).getResults({criterion:A.get("id")})})});t.eeoref.size=v.getResults({criterion:"eeoref"});t.review.size=v.getResults({criterion:"review"});t.participation.size=v.getResults({criterion:"participation"})}this.set({year:this.currentYear,subview_models:{geref:new d.CriteriaDetails({criteria:"single",year:this.currentYear,id:"geref",report:g.Control.get("report"),results:t.geref,title:g.Criteria.findWhere({id:"geref"}).get("title").trim(),summary:this.currentYearData.get("summarygeref")}),ge:new d.CriteriaDetails({criteria:"group",year:this.currentYear,id:"ge",report:g.Control.get("report"),results:t.ge,title:g.CriteriaGroups.findWhere({id:"GE"}).get("title").trim(),summary:this.currentYearData.get("summarygeelements")}),eeoref:new d.CriteriaDetails({criteria:"single",year:this.currentYear,id:"eeoref",report:g.Control.get("report"),results:t.eeoref,title:g.Criteria.findWhere({id:"eeoref"}).get("title").trim(),summary:this.currentYearData.get("summaryeeoref")}),review:new d.CriteriaDetails({criteria:"single",year:this.currentYear,id:"review",report:g.Control.get("report"),results:t.review,title:g.Criteria.findWhere({id:"review"}).get("title").trim(),summary:this.currentYearData.get("summaryreview")}),wp:new d.CriteriaDetails({criteria:"group",year:this.currentYear,id:"wp",report:g.Control.get("report"),results:t.wp,title:g.CriteriaGroups.findWhere({id:"WP"}).get("title").trim(),summary:this.currentYearData.get("summarywp")}),participation:new d.CriteriaDetails({criteria:"single",year:this.currentYear,id:"participation",report:g.Control.get("report"),results:t.geref,title:g.Criteria.findWhere({id:"participation"}).get("title").trim(),summary:this.currentYearData.get("summaryparticipation")})}});this.set("updated",g.Control.get("id")+g.Control.get("year"))},resetFields:function(){this.set({subview_models:{}})}});p.Details=Backbone.View.extend({initialize:function(){this.subviews=[];this.render();this.listenTo(this.model,"change:updated",this.render)},render:function(){this.subviews=[];this.$el.html(this.template());var q=this;_.each(this.model.get("subview_models"),function(s){var r=new p.Criterion({model:s});q.subviews.push(r);q.$("#criteria-details-list").append(r.render().el)});_.each(this.subviews,function(r){r.renderGraphs();r.accordionClose(0)});return this},renderPdf:function(v,r){var t=[v.item("detail1"),v.item("detail2")];var q=[];_.each(this.subviews,function(w){var x=v.defaults.offsets.criteria[w.model.get("id")];var y={x:t[x.p-1].x+x.x,y:t[x.p-1].y+x.y};if(typeof q[x.p-1]==="undefined"){q[x.p-1]=[]}q[x.p-1].push({subview:w,pos:y})});for(var s=0;s<q.length;s++){var u=q[s];_.each(u,function(w){w.subview.renderPdf(v,w.pos)});if(s<q.length-1){v.addPage()}}return this},template:_.template('<div id="criteria-details-list" role="tablist"></div>')});d.CriteriaDetails=Backbone.Model.extend({initialize:function(){var r=this.get("results");var q=this.get("year");if(this.get("report")==="all"){this.set("score",r.all[q].percentage);if(this.get("criteria")==="group"){this.set("all_group_elements",r.all_elements)}this.set("modelAverages",new d.Averages({}));this.set("modelAveragesTime",new d.AveragesTime({all:r.all,legend:false,criterion:this.get("title")}))}else{if(this.get("report")==="entity"){if(this.get("criteria")==="group"){this.set("score",r.entity[q].percentage);this.set("entity_group_elements",r.entity_elements);this.set("all_group_elements",r.all_elements);this.set("type_group_elements",r.type_elements);this.set("size_group_elements",r.size_elements)}else{this.set("score",Math.round(r.entity[q].percentage/100)*100)}this.set("modelAverages",new d.Averages({all:r.all[q].percentage,type:r.type[q].percentage,size:r.size[q].percentage}));this.set("modelAveragesTime",new d.AveragesTime({all:r.all,type:r.type,size:r.size,entity:r.entity,legend:false,criterion:this.get("title")}))}else{if(this.get("report")==="type"){this.set("score",r.type[q].percentage);if(this.get("criteria")==="group"){this.set("all_group_elements",r.all_elements);this.set("type_group_elements",r.type_elements)}this.set("modelAverages",new d.Averages({all:r.all[q].percentage}));this.set("modelAveragesTime",new d.AveragesTime({all:r.all,type:r.type,legend:false,criterion:this.get("title")}))}else{if(this.get("report")==="size"){this.set("score",r.size[q].percentage);if(this.get("criteria")==="group"){this.set("all_group_elements",r.all_elements);this.set("size_group_elements",r.size_elements)}this.set("modelAverages",new d.Averages({all:r.all[q].percentage}));this.set("modelAveragesTime",new d.AveragesTime({all:r.all,size:r.size,legend:false,criterion:this.get("title")}))}}}}}});p.Criterion=Backbone.View.extend({initialize:function(){this.subviews={}},events:{"click .accordion-toggle":"accordionToggle"},accordionToggle:function(q){q.preventDefault();if(this.$(".accordion").hasClass("open")){this.accordionClose()}else{g.Control.accordionCloseAll();this.accordionOpen()}},accordionOpen:function(){var q=this;this.$(".accordion-bottom").slideDown(function(){q.$(".accordion").addClass("open");q.$(".accordion-top").attr("aria-expanded",true);q.$(".accordion-top").attr("aria-selected",true);q.$(".accordion-bottom").attr("aria-expanded",true);q.$(".accordion-bottom").attr("aria-hidden",false);q.$("button.accordion-open").attr("aria-hidden",true);q.$("button.accordion-false").attr("aria-hidden",false)})},accordionClose:function(r){r=typeof r!=="undefined"?r:400;var q=this;this.$(".accordion-bottom").slideUp(r,function(){q.$(".accordion").removeClass("open");q.$(".accordion-top").attr("aria-expanded",false);q.$(".accordion-top").attr("aria-selected",false);q.$(".accordion-bottom").attr("aria-expanded",false);q.$(".accordion-bottom").attr("aria-hidden",true);q.$("button.accordion-open").attr("aria-hidden",false);q.$("button.accordion-false").attr("aria-hidden",true)})},render:function(){this.$el.html(this.template(this.model.attributes));var s=this;var q=true;if(this.model.get("criteria")==="group"){var r=0;_.each(this.model.attributes.all_group_elements,function(t){if(s.model.get("report")==="all"){s.$(".group-elements").append(s.template_elements_all($.extend(t,{year:s.model.attributes.year})))}else{if(s.model.get("report")==="entity"){s.$(".group-elements").append(s.template_elements_entity($.extend(s.model.attributes,{index:r})))}else{if(s.model.get("report")==="type"){s.$(".group-elements").append(s.template_elements_type($.extend(s.model.attributes,{index:r})))}else{if(s.model.get("report")==="size"){s.$(".group-elements").append(s.template_elements_size($.extend(s.model.attributes,{index:r})))}}}}r++});q=false}this.subviews.averagesView=new p.Averages({model:this.model.get("modelAverages")});this.$(".averages-panel").append(this.subviews.averagesView.render().el);this.subviews.averagesGraphView=new p.AveragesTimeGraph({model:this.model.get("modelAveragesTime"),marker:q});this.$(".criteria-time-graph").append(this.subviews.averagesGraphView.render().el);return this},renderGraphs:function(){this.subviews.averagesGraphView.renderGraph()},renderPdf:function(v,q){v.addLine("half_line",$.extend(q,{color:m.dark}));v.addCriteriaTitle(this.model.get("title"),this.model.get("score"),this.model.get("report"),this.model.get("criteria"),q);if(this.model.get("criteria")==="single"){if(this.model.get("modelAverages").get("all")>-1){this.subviews.averagesView.renderPdf(v,"averages",{x:q.x,y:q.y+v.defaults.offsets.averages.single});v.addText(this.model.get("summary"),"half",{x:q.x,y:q.y+v.defaults.offsets.summary.single})}else{v.addText(this.model.get("summary"),"half",{x:q.x,y:q.y+v.defaults.offsets.summary.single-15})}}else{if(this.model.get("criteria")==="group"){var t=this;var s=0;var u=[];if(this.model.get("report")==="all"){u=this.model.get("all_group_elements")}else{if(this.model.get("report")==="entity"){u=this.model.get("entity_group_elements")}else{if(this.model.get("report")==="type"){u=this.model.get("type_group_elements")}else{if(this.model.get("report")==="size"){u=this.model.get("size_group_elements")}}}}var w=20;for(var s=0;s<u.length;s++){var r=u[s];v.addGroupCriteria(r.title,r.results[t.model.attributes.year].percentage,this.model.get("report"),{x:q.x,y:q.y+w});w+=6}v.addLine("half_line",{x:q.x,y:q.y+v.defaults.offsets.averages.group-3});if(this.model.get("modelAverages").get("all")>-1){this.subviews.averagesView.renderPdf(v,"averages",{x:q.x,y:q.y+v.defaults.offsets.averages.group});v.addText(this.model.get("summary"),"half",{x:q.x,y:q.y+v.defaults.offsets.summary.group})}else{v.addText(this.model.get("summary"),"half",{x:q.x,y:q.y+v.defaults.offsets.summary.group-15})}}}},template:_.template('  <div class="criteria row">\n    <div class="accordion">\n      <div class="accordion-top row" role="tab" aria-expanded="false" aria-selected="false">\n        <a href="#" aria-hidden="true" role="button" class="accordion-open accordion-toggle icon-accordion-toggle" title="Show more" aria-label="Show more"></a>\n        <a href="#" aria-hidden="false" role="button" class="accordion-close accordion-toggle icon-accordion-toggle" title="Show less" aria-label="Show less"></a>\n        <div class="col-left">\n          <h2 class="title-score-wrap">\n          <div class="title-score" >\n            <% if (report === "entity" && score === 100 && criteria === "single") { %>\n              <span class="icon-score-pass" aria-label="Entity compliant for criteria"></span><span class="the-score active sr-only"><%= score %>%</span>\n            <% } else if (report === "entity" && score === 0 && criteria === "single") { %>\n              <span class="icon-score-fail" aria-label="Entity not compliant for criteria"></span><span class="the-score active sr-only"><%= score %>%</span>\n            <% } else { %>\n              <% if (score === 0) { %> \n                <span class="icon-score-inverse" aria-label="Compliance for criteria"></span><span class="the-score active"><%= score %>%</span>\n              <% } else { %>\n                <span class="icon-score" aria-label="Compliance for criteria"></span><span class="the-score"><%= score %>%</span>\n              <% } %>\n            <% } %>\n          </div>\n          <div class="title"><a href="#" class="accordion-toggle" title="Show or hide details"><%= title %></a></div>\n        </h2><!-- .title-score-wrap -->\n        </div><!-- .col-left -->\n        <div class="col-right">\n          <div class="averages-panel"></div>\n        </div><!-- .col-right -->\n      </div><!-- .accordion-top -->\n      <div class="accordion-bottom row" role="tabpanel" aria-expanded="true" aria-hidden="false">\n        <% if (criteria === "group") { %><div class="group-elements"></div><% } %>\n        <div class="col-left">\n          <div class="summary-panel"><%= summary %></div>\n        </div><!-- .col-left -->\n        <div class="col-right">\n          <div class="criteria-time-graph"></div><!-- .criteria-time-graph -->\n        </div><!-- .col-right -->\n      </div><!-- .accordion-bottom -->\n    </div><!-- .accordion-->\n  </div><!-- .criteria -->\n'),template_elements_all:_.template('<div class="item row">\n<div class="col-1"><span class="score-all active"><%= results[year].percentage %>%</span></div>\n<div class="col-2"><span class="title"><%= title %></span></div>\n</div>\n'),template_elements_entity:_.template('<div class="item row">\n<div class="col-1">\n<% if (entity_group_elements[index].results[year].percentage >= 50 ) { %>\n<span class="score-entity"><span class="icon-score-pass-small"></span></span>\n<% } else if (entity_group_elements[index].results[year].percentage < 50 ) { %>\n<span class="score"><span class="icon-score-fail-small"></span></span>\n<% } %>\n</div>\n<div class="col-2"><span class="title"><%= entity_group_elements[index].title %></span></div>\n<div class="col-3"><span class="score-type"><%= type_group_elements[index].results[year].percentage %>%</span></div>\n<div class="col-4"><span class="score-size"><%= size_group_elements[index].results[year].percentage %>%</span></div>\n<div class="col-5"><span class="score-all"><%= all_group_elements[index].results[year].percentage %>%</span></div>\n</div>'),template_elements_type:_.template('<div class="item row">\n<div class="col-1"><span class="score-type active"><%= type_group_elements[index].results[year].percentage %>%</span></div>\n<div class="col-2"><span class="title"><%= type_group_elements[index].title %></span></div>\n<div class="col-3"><span class="score-all"><%= all_group_elements[index].results[year].percentage %>%</span></div>\n</div>'),template_elements_size:_.template('<div class="item row">\n<div class="col-1"><span class="score-size active"><%= size_group_elements[index].results[year].percentage %>%</span></div>\n<div class="col-2"><span class="title"><%= size_group_elements[index].title %></span></div>\n<div class="col-3"><span class="score-all"><%= all_group_elements[index].results[year].percentage %>%</span></div>\n</div>')});d.Averages=Backbone.Model.extend({defaults:{title:"Average compliance of",all:-1,type:-1,size:-1,all_label:"All entities",type_label:"Same type",size_label:"Same size",all_color:i(m.all),type_color:i(m.type),size_color:i(m.size)}});p.Averages=Backbone.View.extend({initialize:function(q){this.options=q||{}},render:function(){if(this.model.get("all")>-1||this.model.get("type")>-1||this.model.get("size")>-1){this.$el.html(this.template(this.model.attributes))}return this},renderPdf:function(u,s,q){var v={x:0,y:0};var r={top:2,right:16};v.y+=u.addText(this.model.get("title"),s,q);v.y+=1;var t=u.item(s,q);if(this.model.get("type")>-1){u.addText(this.model.get("type_label"),"default",{x:t.x+v.x,y:t.y+v.y+r.top});u.addText(this.model.get("type")+"%","default",{x:t.x+v.x+r.right,y:t.y+v.y+r.top,style:"bold",color:m.type});v.x+=u.addAverageBar(this.model.get("type"),{x:t.x+v.x,y:t.y+v.y,color:m.type})}if(this.model.get("size")>-1){u.addText(this.model.get("size_label"),"default",{x:t.x+v.x,y:t.y+v.y+r.top});u.addText(this.model.get("size")+"%","default",{x:t.x+v.x+r.right,y:t.y+v.y+r.top,style:"bold",color:m.size});v.x+=u.addAverageBar(this.model.get("size"),{x:t.x+v.x,y:t.y+v.y,color:m.size})}if(this.model.get("all")>-1){u.addText(this.model.get("all_label"),"default",{x:t.x+v.x,y:t.y+v.y+r.top});u.addText(this.model.get("all")+"%","default",{x:t.x+v.x+r.right,y:t.y+v.y+r.top,style:"bold",color:m.all});v.x+=u.addAverageBar(this.model.get("all"),{x:t.x+v.x,y:t.y+v.y,color:m.all})}v.y+=9;u.addLine("half_line",{x:t.x,y:t.y+v.y})},template:_.template('    <div class="averages">\n      <div class="averages-title"><%=title%></div>\n      <ul class="averages-list">\n      <% if (type > -1) {%>\n      <li>\n        <div class="average-type averages-full"><span class="averages-score" style="width:<%=type%>%;background:<%=type_color%>;"></span></div>\n        <div><%=type_label%> <%=type%>%</div>\n      </li><% }%>\n      <% if (size > -1) {%>\n      <li>\n        <div class="average-size averages-full"><span class="averages-score" style="width:<%=size%>%;background:<%=size_color%>;"></span></div>\n        <div><%=size_label%> <%=size%>%</div>\n      </li><% }%>\n      <% if (all > -1) {%>\n      <li>\n        <div class="average-all averages-full"><span class="averages-score" style="width:<%=all%>%;background:<%=all_color%>;"></span></div>\n        <div><%=all_label%> <%=all%>%</div>\n      </li><% }%>\n    </div>\n    ')});d.AveragesTime=Backbone.Model.extend({defaults:{title:"Compliance over time",criterion:"Overall compliance",all:{},type:{},size:{},entity:{},all_label:"All entities",type_label:"Same type",size_label:"Same size",entity_label:"Current entity",legend:true,axis_label:"Compliance"}});p.AveragesTimeGraph=Backbone.View.extend({initialize:function(q){this.options=q||{};this.ticks=[[0,"0%"],[50,"50%"],[100,"100%"]];this.axis_padding=0.05},attributes:{"class":"time-graph"},events:{"plothover .time-plot":"plothover","plotclick .time-plot":"plotclick"},plotOptions:{yaxis:{tickColor:i(m.dark),color:i(m.dark),min:0,max:100,position:"right",tickLength:5,font:{color:i(m.dark),size:13},autoscaleMargin:0},xaxis:{color:i(m.dark),tickSize:1,tickDecimals:0,tickLength:0,font:{color:i(m.dark),size:13,weight:"bold"},autoscaleMargin:0},legend:{show:false},grid:{hoverable:true,clickable:true,autoHighlight:true,backgroundColor:"#ffffff",show:true,aboveData:false,margin:0,labelMargin:10,markings:[],borderWidth:{top:0,right:1,bottom:1,left:0},borderColor:i(m.dark),color:i(m.dark),minBorderMargin:0,axisMargin:0},series:{shadowSize:0}},render:function(){this.$el.html(this.template($.extend(this.model.attributes,{cid:this.cid})));return this},lineOptions:function(q,s){var t=1.7;var r=2.5;if(q==="all"){if(g.Control.get("report")==="all"){return $.extend(s,{lines:{show:true,lineWidth:r},points:{show:true}})}else{return $.extend(s,{dashes:{show:true,lineWidth:t,dashLength:2}})}}else{if(q==="type"){if(g.Control.get("report")==="type"){return $.extend(s,{lines:{show:true,lineWidth:r},points:{show:true}})}else{return $.extend(s,{dashes:{show:true,lineWidth:t,dashLength:5}})}}else{if(q==="size"){if(g.Control.get("report")==="size"){return $.extend(s,{lines:{show:true,lineWidth:r},points:{show:true}})}else{return $.extend(s,{dashes:{show:true,lineWidth:t,dashLength:8}})}}else{if(q==="entity"){return $.extend(s,{lines:{show:true,lineWidth:r},points:{show:true}})}}}}},renderGraph:function(){var r=_.clone(this.plotOptions);r.yaxis.ticks=this.ticks;var u=[];var v=[];r.colors=[];var t=this.$(".time-plot-table table tbody");t.append('<tr><td></td><th scope="col">Year></th><th scope="col">Compliance in %</th></tr>');var q=Object.keys(this.model.get("all"));r.xaxis.max=Math.max.apply(Math,q)+((q.length-1)*this.axis_padding);r.xaxis.min=Math.min.apply(Math,q)-((q.length-1)*this.axis_padding);var s=this;_.each(this.model.get("all"),function(w){u.push([w.year,w.percentage]);t.append("<tr><td>"+s.model.get("all_label")+"</td><td>"+w.year+"</td><td>"+w.percentage+"%</td></tr>")});v.push(this.lineOptions("all",{data:u}));r.colors.push(i(m.all));u=[];if(!$.isEmptyObject(this.model.get("type"))){_.each(this.model.get("type"),function(w){u.push([w.year,w.percentage]);t.append("<tr><td>"+s.model.get("type_label")+"</td><td>"+w.year+"</td><td>"+w.percentage+"%</td></tr>")});v.push(this.lineOptions("type",{data:u}));r.colors.push(i(m.type))}u=[];if(!$.isEmptyObject(this.model.get("size"))){_.each(this.model.get("size"),function(w){u.push([w.year,w.percentage]);t.append("<tr><td>"+s.model.get("size_label")+"</td><td>"+w.year+"</td><td>"+w.percentage+"%</td></tr>")});v.push(this.lineOptions("size",{data:u}));r.colors.push(i(m.size))}u=[];if(!$.isEmptyObject(this.model.get("entity"))){_.each(this.model.get("entity"),function(w){u.push([w.year,w.percentage]);t.append("<tr><td>"+s.model.get("entity_label")+"</td><td>"+w.year+"</td><td>"+w.percentage+"%</td></tr>")});v.push(this.lineOptions("entity",{data:u}));r.colors.push(i(m.entity))}this.plot=$.plot(this.$(".time-plot"),v,r);if(this.model.get("legend")){$(".plot-wrapper-"+this.cid+" .legend").html(this.template_legend($.extend(this.model.attributes,{report:g.Control.get("report")})))}},plotclick:function(r,s,q){r.preventDefault();if(q){g.App.navigate(q.datapoint[0]+"/report/"+g.Control.get("report")+"-"+g.Control.get("id"),{trigger:true})}},plothover:function(s,u,r){var q,t;if(this.hoverTip){this.hoverTip.remove()}if(r){document.body.style.cursor="pointer";this.hoverTip=$(this.toolTipHTML(r.datapoint));this.$(".time-plot").parent().append(this.hoverTip);q=this.hoverTip.outerHeight();t=this.hoverTip.outerWidth();this.hoverTip.offset({left:r.pageX-t/2,top:r.pageY-q-15})}else{document.body.style.cursor="default"}},toolTipHTML:function(r){var q="";q+='<div class="tooltip tooltip-time">';q+='<div class="tooltip-inner-wrap">';q+='<div class="stats">Year: '+r[0]+"</div>";q+='<div class="stats">Compliance: '+r[1]+"%</div>";q+="</div>";q+="</div>";return q},renderPdf:function(q,y,x){q.addPlot(this.plot.getCanvas(),y,x);q.addText(this.model.get("axis_label"),y+"_axis_label");q.addText(this.model.get("title"),y+"_title");var v=q.item(y);for(var t=0;t<this.ticks.length;t++){q.addText(this.ticks[this.ticks.length-1-t][1],y+"_ticks",{offy:v.h*0.79/(this.ticks.length-1)*t})}var z=Object.keys(this.model.get("all"));for(var t=0;t<z.length;t++){var w=(v.w*0.85*(1-2*this.axis_padding)/(z.length-1)*t)+v.w*0.85*this.axis_padding;q.addText(z[t],y+"_xticks",{offx:w})}var v=q.item(y+"_legend");var r=this.model.attributes;var s=g.Control.get("report");var u=0;var w=8;if(!$.isEmptyObject(r.entity)){q.addLine(y+"_legend_line",{color:m.entity,offy:u});q.addText(r.entity_label,y+"_legend",{offx:w});u+=4}if(!$.isEmptyObject(r.type)){if(s==="type"){q.addLine(y+"_legend_line",{color:m.type,offy:u})}else{q.addLine(y+"_legend_line",{color:m.type,offy:u,dash:0.66})}q.addText(r.type_label,y+"_legend",{offx:w,offy:u});u+=4}if(!$.isEmptyObject(r.size)){if(s==="size"){q.addLine(y+"_legend_line",{color:m.size,offy:u})}else{q.addLine(y+"_legend_line",{color:m.size,offy:u,dash:1})}q.addText(r.size_label,y+"_legend",{offx:w,offy:u});u+=4}if(s==="all"){q.addLine(y+"_legend_line",{color:m.all,offy:u})}else{q.addLine(y+"_legend_line",{color:m.all,offy:u,dash:0.33})}q.addText(r.all_label,y+"_legend",{offx:w,offy:u})},template:_.template('<div class="plot-wrapper plot-wrapper-<%= cid %>">\n<div class="averages-title"><%= title %></div>\n<div aria-hidden="true" role="presentation" class="yaxis-label"><%= axis_label %></div>\n<div class="time-plot" aria-label="<%= title %> for <%= criterion %> - Chart. Details in the following table" role="img" ></div>\n<div aria-hidden="true" role="presentation" class="legend"></div>\n<div class="time-plot-table sr-only">\n<summary><%= title %> for <%= criterion %> - Table</summary>\n<table>\n<caption><%= title %> for <%= criterion %> </caption>\n<tbody>\n</tbody>\n</table>\n</div>\n</div>'),template_legend:_.template('    <ul class="legend-list"><% if (!$.isEmptyObject(entity)){%><li class="legend-entity <% if (report === "entity"){%>legend-main<% } %>">\n<span class="line"></span>\n<span class="legend-label"><%=entity_label%></span>\n</li><% }%><% if (!$.isEmptyObject(type)){%><li class="legend-type <% if (report === "type"){%>legend-main<% } %>">\n<span class="line"></span>\n<span class="legend-label"><%=type_label%></span>\n</li><% }%><% if (!$.isEmptyObject(size)){%><li class="legend-size <% if (report === "size"){%>legend-main<% } %>">\n<span class="line"></span>\n<span class="legend-label"><%=size_label%></span>\n</li><% }%><li class="legend-all <% if (report === "all"){%>legend-main<% } %>">\n<span class="line"></span>\n<span class="legend-label"><%=all_label%></span>\n</li>    </ul>    ')});d.Footer=Backbone.Model.extend({initialize:function(){this.monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],this.set({claim:"Mana me ngā tika tangata ma tātou - Dignity and human rights for all",hrc_url_title:"To explore all good employer reports visit:",hrc_url_anchor:"www.hrc.co.nz/eeo",published:"Last updated: "+g.Control.get("updated").getDate()+". "+this.monthNames[g.Control.get("updated").getMonth()]+" "+g.Control.get("updated").getFullYear(),isbn:"ISBN: "+j,copyright:"&#0169; "+g.Control.get("updated").getFullYear()+" New Zealand Human Rights Commission",hrc_url:"http://www.hrc.co.nz/eeo",builtby_url:"http://dumpark.com",builtby:"a data visualisation by dumpark"})}});p.Footer=Backbone.View.extend({initialize:function(){this.render()},render:function(){this.$el.html(this.template(this.model.attributes))},renderPdf:function(q){q.addImage("footer","footer_image");q.addText(this.model.get("hrc_url_title"),"footer_url_title");q.addText(this.model.get("hrc_url_anchor"),"footer_url");q.addText(this.model.get("published"),"footer_published");q.addText(this.model.get("isbn"),"footer_isbn");q.addLine("footer_line1");q.addLine("footer_line2")},template:_.template('<div class="footer-scene">\n  <div class="col-left">\n    <div class="footer-wrap-left">\n      <div class="footer-claim"><%= claim %></div>\n      <div class="footer-hrcurl-title"><%= hrc_url_title %></div>\n      <div class="footer-hrcurl"><a href="<%= hrc_url %>" target="_blank" title="<%= hrc_url_title %> <%= hrc_url_anchor %>"><%= hrc_url_anchor %></a></div>\n    </div>\n  </div>\n  <div class="col-right">\n    <div class="footer-wrap-right">\n      <div class="footer-published"><%= published %></div>\n      <div class="footer-copyright"><%= copyright %></div>\n    </div>\n  </div>\n</div>\n<div class="footer-builtby pull-right"><a href="<%= builtby_url %>" target="_blank" title="<%= builtby %>"><%= builtby %></a></div>\n    ')});function c(){$.getJSON("data/pdfimagedata.json",function(q){g.docWriter=new d.DocWriter({images:q});g.viewsIntro.renderPdf(g.docWriter);g.viewsOverview.renderPdf(g.docWriter);g.docWriter.addText("1/2","page_no");g.viewsDetails.renderPdf(g.docWriter);g.docWriter.addText("2/2","page_no");g.viewsFooter.renderPdf(g.docWriter);g.docWriter.output()})}d.DocWriter=Backbone.Model.extend({initialize:function(){this.doc=new jsPDF({lineHeight:this.defaults.lineHeight});this.doc.setFontSize(this.defaults.elements.def.size)},defaults:{lineHeight:1.4,offsets:{averages:{single:23,group:70},detail_title:{x:15,y:11},summary:{single:42,group:89},criteria:{geref:{p:1,y:0,x:0},eeoref:{p:1,y:0,x:95},ge:{p:2,y:0,x:0},wp:{p:2,y:0,x:95},review:{p:2,y:130,x:0},participation:{p:2,y:130,x:95}}},elements:{def:{y:15,x:15,w:180,h:0,size:8,style:"normal",margin:{top:0,bottom:2,right:0,left:0},color:m.dark,offy:0,offx:0},half:{y:15,x:15,w:85,h:0,size:8,style:"normal",margin:{top:0,bottom:2,right:0,left:0},color:m.dark},intro_title:{y:15,size:17,style:"bold"},intro_subtitle:{y:24,size:10,style:"bold"},intro_summary:{y:32,w:128},intro_logo:{y:13,x:163,w:32,h:35},intro_line:{y:58,h:0.75,color:m.dark},overview_title:{y:71,w:130,size:16,yalign:"center"},overview_subtitle:{y:70,w:130,color:m.medium},overview_year:{y:63,x:169,size:27,style:"bold"},overview_type_label:{y:71,x:15,style:"bold"},overview_type:{y:71,x:23},overview_size_label:{y:75,x:15,style:"bold"},overview_size:{y:75,x:23},overview_score_label:{y:96,size:10,style:"bold"},overview_score:{y:99,size:40,style:"bold"},overview_score_trend:{y:104,x:53,w:7,h:7},overview_score_change:{y:111,x:53},overview_score_line:{y:117,w:44,h:0.75,color:m.light},overview_rank_label:{y:124,style:"bold",w:44,yalign:"center"},overview_rank:{y:126,size:23,style:"bold"},overview_rank_of:{y:131,x:25},overview_rank_trend:{y:124,x:53,w:7,h:7},overview_rank_change:{y:131,x:54},overview_rank_line:{y:138,w:44,h:0.75,color:m.light},overview_graph:{y:100,x:63,w:132,h:39.3},overview_graph_axis_label:{y:96,x:180,size:7},overview_graph_ticks:{y:103,x:188,yalign:"center"},averages_graph:{y:149,x:107,w:89,h:34},averages_graph_title:{y:144,x:110,style:"bold"},averages_graph_axis_label:{y:145,x:180,size:7},averages_graph_ticks:{y:152,x:188,yalign:"center"},averages_graph_xticks:{y:179,x:107,style:"bold"},averages_graph_legend:{y:186,x:110,size:7},averages_graph_legend_line:{y:187.6,x:110,w:5,h:1},overview_averages:{y:142.5,w:85,style:"bold"},averages:{w:85,style:"bold"},overview_summary:{y:162,w:85},average_line:{w:22,h:4,margin:{right:6},color:m.light},half_line:{w:85,h:0.75,color:m.light},detail1:{y:208},detail2:{y:15},detail_title:{style:"bold",w:65,size:11},detail_image:{w:12,h:12},detail_image_small:{w:3,h:3},detail_score:{style:"bold",size:11,color:m.white},footer_image:{y:222,w:180,color:m.white},footer_url_title:{y:270,x:20,w:75,size:7,color:m.white},footer_url:{y:273,x:20,w:75,size:10,color:m.white},footer_published:{y:255,x:103,w:56,size:7,color:m.white},footer_isbn:{y:259,x:103,w:56,size:7,color:m.white},footer_c:{y:274,x:103,w:56,size:7,style:"bold",color:m.white},footer_line1:{y:255,x:100,w:1,h:22,color:m.white},footer_line2:{y:255,x:162,w:1,h:22,color:m.white},page_no:{y:279.3,x:199,size:7}}},item:function(r,q){q=typeof q!=="undefined"?q:{};var s=$.extend({},this.defaults.elements[r]);var t=$.extend({},this.defaults.elements.def);s=$.extend(s,q);return $.extend(t,s)},convert2pt:function(q){return q*this.doc.internal.scaleFactor},convert2mm:function(q){return q/this.doc.internal.scaleFactor},output:function(){var q="HRC-Good-Employer_";if(g.Control.get("report")==="all"){q+="All-Entities"}else{if(g.Control.get("report")==="type"){q+="Type-"+g.Control.get("id")}else{if(g.Control.get("report")==="size"){q+="Size-"+g.Control.get("id")}else{if(g.Control.get("report")==="entity"){q+=g.Records.byYear(parseInt(g.Control.get("year"))).byEntity(g.Control.get("id")).first().get("title").replace(/\s/g,"-")}}}}this.doc.save(q+"_"+g.Control.get("year")+".pdf")},addText:function(u,t,w){if(u===""){return 0}t=typeof t!=="undefined"?t:"def";var v=this.item(t,w);var r=(v.yalign!=="undefined")?v.yalign:"top";this.doc.setFontSize(v.size);this.doc.setFontStyle(v.style);this.doc.setTextColor(v.color.r,v.color.g,v.color.b);u=u.toString().replace(/[\u0101]/g,"a");var q=this.doc.splitTextToSize(u,this.convert2pt(v.w/1.3));var x=q.length*this.convert2mm(v.size)*this.defaults.lineHeight+v.margin.bottom;if(r==="center"){x=x/2;v.y-=x}this.doc.text(v.x+v.offx,v.y+v.offy+this.convert2mm(v.size),q);return x},addLine:function(q,v){var u=this.item(q,v);var w="h";if(u.h>u.w){var t=u.h;u.h=u.w;u.w=t;w="v"}this.doc.setLineWidth(this.convert2mm(u.h));this.doc.setDrawColor(u.color.r,u.color.g,u.color.b);if(typeof u.dash!=="undefined"){var r=0;for(var s=0;s<Math.floor(u.w/(u.dash));s++){if(s%2===0){this.doc.line(u.x+r,u.y+u.offy,u.x+u.dash+r,u.y+u.offy)}r+=u.dash}}else{if(w==="h"){this.doc.line(u.x,u.y+u.offy,u.x+u.w,u.y+u.offy)}else{this.doc.line(u.x,u.y+u.offy,u.x,u.y+u.offy+u.w)}}},addImage:function(r,s,q,u){q=typeof q!=="undefined"?q:{};u=typeof u!=="undefined"?u:{};var t=this.item(s,u);var v=this.get("images")[r];v=$.extend(v,q);this.doc.addImage(v.data,v.format,t.x,t.y,t.w,t.h)},addPlot:function(s,x,t){var z=this.item(x,t);var q=2;var w=s.width*q;var u=s.height*q;var v=document.createElement("canvas");v.width=w;v.height=u;var y=v.getContext("2d");y.fillStyle="#FFFFFF";y.fillRect(0,0,w,u);y.drawImage(s,0,0,w,u);var r=v.toDataURL("image/jpeg");this.doc.addImage(r,"JPEG",z.x,z.y,z.w,z.h)},addAverageBar:function(s,r){this.addLine("average_line",{x:r.x,y:r.y});var q=this.item("average_line");this.addLine("average_line",{x:r.x,y:r.y,w:q.w*s/100,color:r.color});return q.w+q.margin.right},addCircle:function(q){this.doc.setFillColor(q.color.r,q.color.g,q.color.b);this.doc.circle(q.x,q.y,q.r,"F")},addTick:function(q){this.doc.setLineWidth(1.8);this.doc.setDrawColor(q.color.r,q.color.g,q.color.b);this.doc.line(q.x+3,q.y+5.69,q.x+5.62,q.y+8.31);this.doc.line(q.x+4.38,q.y+8.31,q.x+9,q.y+3.69)},addCross:function(q){this.doc.setLineWidth(1.8);this.doc.setDrawColor(q.color.r,q.color.g,q.color.b);this.doc.line(q.x+3.69,q.y+3.69,q.x+8.31,q.y+8.31);this.doc.line(q.x+3.69,q.y+8.31,q.x+8.31,q.y+3.69)},addCriteriaTitle:function(u,t,s,w,r){var q="details_"+s+"_";var v=2.2;if(t<10){v=3.2}else{if(t>99){v=1.2}}if(s==="entity"&&t===100&&w==="single"){this.addCircle({x:r.x+6,y:r.y+9.8,r:6,color:m[s]});this.addTick({x:r.x,y:r.y+4,color:m.white})}else{if(s==="entity"&&t===0&&w==="single"){this.addCircle({x:r.x+6,y:r.y+9.8,r:6,color:m.lighter});this.addCross({x:r.x,y:r.y+4,color:m.entity})}else{if(t===0){this.addCircle({x:r.x+6,y:r.y+9.8,r:6,color:m.lighter});this.addText(t+"%","detail_score",{color:m[s],x:r.x+v,y:r.y+this.defaults.offsets.detail_title.y,yalign:"center"})}else{this.addCircle({x:r.x+6,y:r.y+9.8,r:6,color:m[s]});this.addText(t+"%","detail_score",{x:r.x+v,y:r.y+this.defaults.offsets.detail_title.y,yalign:"center"})}}}this.addText(u,"detail_title",{x:r.x+this.defaults.offsets.detail_title.x,y:r.y+this.defaults.offsets.detail_title.y,yalign:"center"});this.addLine("half_line",{x:r.x,y:r.y+20})},addGroupCriteria:function(u,t,s,r){if(s==="entity"){var q="details_entity_";if(t>=50){q+="pass_small";this.addImage(q,"detail_image_small",{},{x:r.x+4.5,y:r.y+3})}else{if(t<50){q+="fail_small";this.addImage(q,"detail_image_small",{},{x:r.x+4.5,y:r.y+3})}}}else{var v=3;if(t<10){v=4}else{if(t>99){v=1.4}}this.addText(t+"%","def",{x:r.x+v,y:r.y+3,style:"bold"})}this.addText(u,"def",{x:r.x+10,y:r.y+3})},addPage:function(){this.doc.addPage()}});function o(q){$(".loading."+q).hide();$(".waiting."+q).removeClass("waiting").css("visibility","visible");$("#report").attr("aria-busy",false)}function a(r){var q=r.toString(16);return q.length===1?"0"+q:q}function i(q){return"#"+a(q.r)+a(q.g)+a(q.b)}if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}if(!Object.keys){Object.keys=(function(){var s=Object.prototype.hasOwnProperty,t=!({toString:null}).propertyIsEnumerable("toString"),r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],q=r.length;return function(w){if(typeof w!=="object"&&(typeof w!=="function"||w===null)){throw new TypeError("Object.keys called on non-object")}var u=[],x,v;for(x in w){if(s.call(w,x)){u.push(x)}}if(t){for(v=0;v<q;v++){if(s.call(w,r[v])){u.push(r[v])}}}return u}}())}n.App=Backbone.Router.extend({routes:{"":"redirect","report/*filter":"redirect",":year":"year",":year/report/*filter":"report"},redirect:function(q){var r=g.Years.getLast();if(q){this.navigate(r.toString()+"/report/"+q,{trigger:true})}else{this.navigate(r.toString(),{trigger:true})}},year:function(q){if($.isNumeric(q)){this.navigate(q+"/report/all-entities",{trigger:true})}else{this.navigate("",{trigger:true})}},report:function(s,q){var r=q.split("-");if($.inArray(r[0],["all","entity","type","size"])===-1||r[1]==="none"||r[1]===""){this.navigate(s+"/report/all-entities",{trigger:true})}else{g.Control.set({year:s,report:r[0],id:r[1]});$("#report").removeClass(function(t,u){return(u.match(/\breport-\S+/g)||[]).join(" ")});$("#report").addClass("report-"+r[0]).addClass("report-id-"+r[1]);g.Overview=g.Overview||new d.Overview();g.Details=g.Details||new d.Details();g.Footer=g.Footer||new d.Footer();g.Overview.update();g.Details.update();g.viewsIntro=g.viewsIntro||new p.Intro({el:$("#intro"),model:new d.Intro()});g.viewsTools=g.viewsTools||new p.Tools({el:$("#tools"),model:g.Control});g.viewsOverview=g.viewsOverview||new p.Overview({el:$("#overview"),model:g.Overview});g.viewsDetails=g.viewsDetails||new p.Details({el:$("#details"),model:g.Details});g.viewsFooter=g.viewsFooter||new p.Footer({el:$("#footer"),model:g.Footer})}}});function e(q){g.Control=new d.Control({updated:new Date(q.Years.updated)});g.Years=new d.Years(q.Years.elements);g.Types=new d.Types(q.Types.elements);g.Sizes=new d.Sizes(q.Sizes.elements);g.Criteria=new d.Criteria(q.Criteria.elements);g.CriteriaGroups=new d.CriteriaGroups(q.CriteriaGroups.elements);g.Records=new d.Records();g.Years.each(function(s){if(s.isActive()){var r=q[s.get("year")].elements;_.each(r,function(t){t.year=s.get("year")});g.Records.add(r)}})}function h(q){e(q);o("onData");g.App=new n.App();Backbone.history.start()}$(function(){Tabletop.init({key:f,parseNumbers:true,callback:h,proxy:"https://hrceeo.s3.amazonaws.com"})})});